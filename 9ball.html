<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>9-Ball Professional Tracker</title>
    <link rel="manifest" href="manifest.json">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root { 
            --felt: #f1c40f; --slate: #1a1a1a; --gold: #f1c40f; --chalk: #3498db; --danger: #e74c3c;
            --ball-9: #f1c40f; --done-bg: #f8f9fa;
        }
        * { box-sizing: border-box; touch-action: manipulation; }
        body { 
            font-family: 'Inter', sans-serif; background-color: var(--slate); 
            background-image: radial-gradient(circle, #444 0%, #1a1a1a 100%);
            margin: 0; padding: 8px; color: #fff;
        }
        .branding { text-align: center; margin-bottom: 12px; }
        .logo-box { background: white; padding: 8px 15px; display: inline-block; border-radius: 12px; }
        .logo-mvp { color:#00FF00; font-size: 26px; font-weight: 900; }
        .logo-tv { color:#FF0000; font-size: 34px; font-style: italic; font-weight: 900; font-family: 'Brush Script MT', cursive; margin-left: -5px; }
        
        .sheet { background: rgba(0, 0, 0, 0.2); border-radius: 15px; padding: 5px; }
        .match-card { background: white; border-radius: 12px; margin-bottom: 12px; overflow: hidden; color: #333; border-left: 6px solid var(--felt); box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .card-done { background: var(--done-bg); border-left: 6px solid #777; }
        
        .head-active { background: var(--felt); color: #000; padding: 8px 12px; font-weight: 900; display: flex; justify-content: space-between; align-items: center; font-size: 0.8rem; }
        .head-done { background: #333; color: #fff; padding: 8px 12px; font-weight: 800; display: flex; justify-content: space-between; align-items: center; font-size: 0.75rem; }

        .grid-main { display: grid; grid-template-columns: 1fr 1fr; padding: 8px; gap: 8px; }
        .name-input { font-weight: 800; border: none; border-bottom: 2px solid #eee; width: 100%; font-size: 0.85rem; margin-bottom: 5px; background:transparent; }

        .ball-container { display: flex; flex-wrap: wrap; gap: 4px; justify-content: center; margin-top: 5px; }
        .ball { 
            width: 26px; height: 26px; border-radius: 50%; border: 1px solid #ccc; 
            display: flex; align-items: center; justify-content: center; 
            font-size: 0.65rem; font-weight: 900; color: #fff; cursor: pointer; text-shadow: 1px 1px 1px #000;
        }
        .ball-selected { border: 2px solid #000; box-shadow: inset 0 0 5px rgba(0,0,0,0.5); transform: scale(1.1); }
        /* Professional 9-ball colors */
        .b1{background:#ffea00;color:#000;text-shadow:none}.b2{background:#0052cc}.b3{background:#cc0000}
        .b4{background:#4b0082}.b5{background:#ff8c00}.b6{background:#008000}
        .b7{background:#8b4513}.b8{background:#000}.b9{background:#ffea00;color:#000;border:2px dashed #000;text-shadow:none}

        .summary-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 10px; text-align: center; }
        .stat-line { background: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 8px; }
        .stat-label { font-size: 0.6rem; color: #888; text-transform: uppercase; font-weight: 900; display: block; }
        .stat-total { font-size: 1.2rem; font-weight: 900; color: #222; }

        .total-score-bar { 
            background: #000; color: var(--gold); padding: 10px; border-radius: 10px; 
            margin: 10px 0; display: grid; grid-template-columns: 1fr auto 1fr; 
            align-items: center; text-align: center; border: 1px solid var(--gold); 
        }
        .total-val { font-size: 1.4rem; font-weight: 900; }

        .actions { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 10px; }
        .action-btn { padding: 12px; border: none; border-radius: 10px; font-weight: 800; color: white; cursor: pointer; text-transform: uppercase; font-size: 0.7rem; }
        .btn-mini { padding: 4px 8px; border-radius: 5px; border: none; font-weight: 800; font-size: 0.6rem; cursor: pointer; }
    </style>
</head>
<body>

<div class="branding">
    <div class="logo-box"><span class="logo-mvp">MVP</span><span class="logo-tv">TV</span></div>
</div>

<div id="capture-area" class="sheet">
    <div id="match-container"></div>
</div>

<div class="total-score-bar">
    <div><div class="total-val" id="h-total">0</div></div>
    <div style="font-weight: 900; font-size: 0.8rem;">TOTAL BALLS</div>
    <div><div class="total-val" id="a-total">0</div></div>
</div>

<div class="actions">
    <button class="action-btn" style="background: var(--felt); color:#000; grid-column: span 2;" onclick="addMatch()">+ New 9-Ball Match</button>
    <button class="action-btn" style="background: var(--chalk);" onclick="exportJPG()">Save JPG</button>
    <button class="action-btn" style="background: var(--danger);" onclick="resetAll()">Reset All</button>
</div>

<script>
    let matches = JSON.parse(localStorage.getItem('mvp_9ball_v3')) || [];

    function refresh() {
        localStorage.setItem('mvp_9ball_v3', JSON.stringify(matches));
        const container = document.getElementById('match-container');
        container.innerHTML = '';
        let tH = 0, tA = 0;

        matches.forEach((m, i) => {
            tH += m.hTotal; tA += m.aTotal;
            const card = document.createElement('div');
            card.className = `match-card ${m.done ? 'card-done' : ''}`;
            
            if (m.done) {
                // Short and Sweet Summary
                card.innerHTML = `
                    <div class="head-done">MATCH ${i+1} FINAL <button class="btn-mini" style="background:#555; color:#fff;" onclick="toggleEdit(${i})">EDIT</button></div>
                    <div class="summary-row">
                        <div class="stat-line"><span class="stat-label">${m.hName || 'HOME'}</span><div class="stat-total">${m.hTotal}</div></div>
                        <div class="stat-line"><span class="stat-label">${m.aName || 'AWAY'}</span><div class="stat-total">${m.aTotal}</div></div>
                    </div>
                    <div style="padding:0 10px 10px; font-size:0.65rem; color:#666; font-weight:800; display:flex; justify-content:space-around;">
                        <span>INN: ${m.innTotal}</span> <span>DEF: ${m.hDef+m.aDef}</span> <span>DB: ${m.dbTotal}</span>
                    </div>
                `;
            } else {
                card.innerHTML = `
                    <div class="head-active">MATCH ${i+1} | ACTIVE <button class="btn-mini" style="background:#000; color:#fff;" onclick="finishMatch(${i})">FINISH</button></div>
                    <div class="grid-main">
                        <div>
                            <input type="text" class="name-input" placeholder="Home Name" value="${m.hName}" oninput="matches[${i}].hName=this.value">
                            <div class="ball-container">${renderBalls(i, 'h')}</div>
                            <div style="margin-top:10px; font-size:0.6rem; font-weight:800;">DEF: <button onclick="adjStat(${i},'hDef',-1)">-</button> ${m.hDef} <button onclick="adjStat(${i},'hDef',1)">+</button></div>
                        </div>
                        <div>
                            <input type="text" class="name-input" placeholder="Away Name" value="${m.aName}" oninput="matches[${i}].aName=this.value">
                            <div class="ball-container">${renderBalls(i, 'a')}</div>
                            <div style="margin-top:10px; font-size:0.6rem; font-weight:800;">DEF: <button onclick="adjStat(${i},'aDef',-1)">-</button> ${m.aDef} <button onclick="adjStat(${i},'aDef',1)">+</button></div>
                        </div>
                    </div>
                    <div style="text-align:center; padding: 8px; background:#f0f0f0; display:flex; justify-content:space-around; align-items:center; font-size:0.7rem; font-weight:800; border-top:1px solid #ddd;">
                        <div>INN: <button onclick="adjStat(${i},'innTotal',-1)">-</button> ${m.innTotal} <button onclick="adjStat(${i},'innTotal',1)">+</button></div>
                        <div>DEAD: <button onclick="adjStat(${i},'dbTotal',-1)">-</button> ${m.dbTotal} <button onclick="adjStat(${i},'dbTotal',1)">+</button></div>
                    </div>
                `;
            }
            container.appendChild(card);
        });
        document.getElementById('h-total').innerText = tH;
        document.getElementById('a-total').innerText = tA;
    }

    function renderBalls(mIdx, side) {
        let html = '';
        for(let n=1; n<=9; n++) {
            const isSel = matches[mIdx].currentRack[side].includes(n);
            html += `<div class="ball b${n} ${isSel?'ball-selected':''}" onclick="toggleBall(${mIdx},'${side}',${n})">${n}</div>`;
        }
        return html;
    }

    function toggleBall(mIdx, side, num) {
        const m = matches[mIdx];
        const opp = side === 'h' ? 'a' : 'h';
        m.currentRack[opp] = m.currentRack[opp].filter(n => n !== num); // Remove from other player
        if (m.currentRack[side].includes(num)) {
            m.currentRack[side] = m.currentRack[side].filter(n => n !== num);
        } else {
            m.currentRack[side].push(num);
        }
        
        // Auto-record rack if 9-ball is selected or all 9 balls are accounted for
        const totalSelected = m.currentRack.h.length + m.currentRack.a.length;
        if(num === 9 || totalSelected === 9) recordRack(mIdx);
        refresh();
    }

    function recordRack(mIdx) {
        const m = matches[mIdx];
        const hPts = m.currentRack.h.reduce((acc, n) => acc + (n === 9 ? 2 : 1), 0);
        const aPts = m.currentRack.a.reduce((acc, n) => acc + (n === 9 ? 2 : 1), 0);
        m.hTotal += hPts; m.aTotal += aPts;
        m.currentRack = { h: [], a: [] };
    }

    function adjStat(mIdx, field, val) { 
        matches[mIdx][field] = Math.max(0, matches[mIdx][field] + val); 
        refresh(); 
    }
    
    function finishMatch(i) { matches[i].done = true; refresh(); }
    function toggleEdit(i) { matches[i].done = false; refresh(); }

    function addMatch() {
        matches.push({
            hName: '', aName: '', hTotal: 0, aTotal: 0, hDef: 0, aDef: 0, innTotal: 0, dbTotal: 0,
            done: false, currentRack: { h: [], a: [] }
        });
        refresh();
    }

    function resetAll() { if(confirm("Reset all data?")) { matches = []; localStorage.clear(); addMatch(); } }
    function exportJPG(){ html2canvas(document.getElementById('capture-area')).then(c=>{const l=document.createElement('a'); l.download='9ball_match.jpg'; l.href=c.toDataURL(); l.click();});}

    if(matches.length === 0) addMatch();
    refresh();
</script>
</body>
</html>