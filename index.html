<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>8-Ball Pro Scorer</title>
    <link rel="manifest" href="manifest.json">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root { --border: #000; --header-bg: #f2f2f2; }
        body { font-family: 'Courier New', Courier, monospace; background: #777; margin: 0; padding: 10px; color: #000; }
        .sheet { background: #fff; border: 2px solid var(--border); max-width: 650px; margin: auto; padding: 15px; box-shadow: 10px 10px 0px #333; }
        .match-card { border: 2px solid var(--border); margin-bottom: 20px; overflow: hidden; }
        .match-header { background: #000; color: #fff; padding: 5px 10px; font-weight: bold; display: flex; justify-content: space-between; }
        
        .grid-main { display: grid; grid-template-columns: 1fr 1fr; border-bottom: 1px solid var(--border); }
        .side { padding: 10px; border-right: 1px solid var(--border); }
        .side:last-child { border-right: none; background: #fdfdfd; }
        .side-label { font-size: 0.7rem; font-weight: bold; text-decoration: underline; margin-bottom: 5px; display: block; }
        
        input[type="text"], input[type="number"] { border: none; border-bottom: 1px solid #ccc; width: 100%; margin-bottom: 8px; font-size: 0.9rem; }
        
        .stat-row { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; text-align: center; margin-top: 10px; }
        .stat-box { display: flex; flex-direction: column; align-items: center; }
        .stat-label { font-size: 0.6rem; font-weight: bold; margin-bottom: 2px; height: 15px; }
        
        .stepper { display: flex; align-items: center; gap: 4px; }
        .btn { width: 30px; height: 30px; border: 1px solid #000; background: #eee; cursor: pointer; font-weight: bold; }
        .val { font-size: 1.1rem; font-weight: bold; min-width: 20px; }

        .timeout-area { margin-top: 8px; display: flex; gap: 5px; align-items: center; }
        .t-btn { width: 35px; height: 25px; font-size: 0.7rem; border: 1px solid #000; background: #fff; cursor: pointer; }
        .t-btn.used { background: #ff4757; color: #fff; border-color: #ff4757; }

        .match-footer { background: var(--header-bg); padding: 8px; display: flex; justify-content: space-around; font-weight: bold; border-top: 1px solid var(--border); }
        .points-entry { display: flex; align-items: center; gap: 10px; }
        .points-entry input { width: 40px; text-align: center; border: 1px solid #000; background: #fff; font-weight: bold; }

        .actions { position: sticky; bottom: 0; background: #777; padding: 10px; display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        button.action-btn { padding: 12px; border: 2px solid #000; font-weight: bold; cursor: pointer; text-transform: uppercase; }
    </style>
</head>
<body>

<div id="capture-area" class="sheet">
    <div style="text-align:center; border-bottom: 2px solid #000; margin-bottom: 10px;">
        <h2 style="margin: 5px;">LEAGUE MATCH BACKUP</h2>
    </div>

    <div id="match-container"></div>

    <div style="border-top: 2px solid #000; padding: 10px; display: flex; justify-content: space-between; font-weight: bold;">
        <span>TEAM MATCHES: <span id="m-count">0</span>/5</span>
        <span>TOTAL POINTS: <span id="p-count">0</span></span>
    </div>
</div>

<div class="actions">
    <button class="action-btn" style="grid-column: span 2; background: #2ed573;" onclick="addMatch()">+ Add New Match</button>
    <button class="action-btn" style="background: #1e90ff; color: #fff;" onclick="exportJPG()">Export JPG</button>
    <button class="action-btn" style="background: #ffa502;" onclick="exportText()">Copy Text</button>
    <button class="action-btn" style="grid-column: span 2; background: #ff4757; color: white;" onclick="clearAll()">Reset Night</button>
</div>

<script>
    let matches = JSON.parse(localStorage.getItem('billiardProSession')) || [];

    function refresh() {
        localStorage.setItem('billiardProSession', JSON.stringify(matches));
        const container = document.getElementById('match-container');
        container.innerHTML = '';
        let totalPoints = 0;

        matches.forEach((m, i) => {
            totalPoints += (Number(m.homePoints) + Number(m.awayPoints));
            container.innerHTML += `
                <div class="match-card">
                    <div class="match-header"><span>MATCH ${i+1}</span> <span>INN: ${m.innings}</span></div>
                    <div class="grid-main">
                        ${renderSide(i, 'home', m.home)}
                        ${renderSide(i, 'away', m.away)}
                    </div>
                    <div style="padding: 10px; display: flex; align-items: center; justify-content: center; border-top: 1px solid #000;">
                        <span style="font-size: 0.7rem; font-weight: bold; margin-right: 10px;">MATCH INNINGS:</span>
                        <div class="stepper">
                            <button class="btn" onclick="stepMatch(${i}, 'innings', -1)">-</button>
                            <span class="val">${m.innings}</span>
                            <button class="btn" onclick="stepMatch(${i}, 'innings', 1)">+</button>
                        </div>
                    </div>
                    <div class="match-footer">
                        <div class="points-entry">HOME PTS: <input type="number" value="${m.homePoints}" oninput="updatePoints(${i}, 'homePoints', this.value)"></div>
                        <div class="points-entry">AWAY PTS: <input type="number" value="${m.awayPoints}" oninput="updatePoints(${i}, 'awayPoints', this.value)"></div>
                    </div>
                </div>
            `;
        });
        document.getElementById('m-count').innerText = matches.length;
        document.getElementById('p-count').innerText = totalPoints;
    }

    function renderSide(idx, side, data) {
        return `
            <div class="side">
                <span class="side-label">${side.toUpperCase()} PLAYER</span>
                <input type="text" placeholder="Name" value="${data.name}" oninput="update(${idx}, '${side}', 'name', this.value)">
                <input type="number" placeholder="SL" value="${data.sl}" oninput="update(${idx}, '${side}', 'sl', this.value)">
                
                <div class="stat-row">
                    ${counter(idx, side, 'Games Won', 'games')}
                    ${counter(idx, side, 'Defensive', 'def')}
                </div>

                <div class="timeout-area">
                    <span class="stat-label">T.O.</span>
                    <button class="t-btn ${data.t1 ? 'used' : ''}" onclick="toggleT(${idx}, '${side}', 't1')">T1</button>
                    <button class="t-btn ${data.t2 ? 'used' : ''}" onclick="toggleT(${idx}, '${side}', 't2')">T2</button>
                </div>
            </div>
        `;
    }

    function counter(idx, side, label, key) {
        return `
            <div class="stat-box">
                <span class="stat-label">${label}</span>
                <div class="stepper">
                    <button class="btn" style="width:25px;height:25px;" onclick="step(${idx}, '${side}', '${key}', -1)">-</button>
                    <span class="val" style="font-size:0.9rem;">${matches[idx][side][key]}</span>
                    <button class="btn" style="width:25px;height:25px;" onclick="step(${idx}, '${side}', '${key}', 1)">+</button>
                </div>
            </div>
        `;
    }

    function addMatch() {
        if (matches.length < 5) {
            matches.push({
                innings: 0, homePoints: 0, awayPoints: 0,
                home: { name: '', sl: '', games: 0, def: 0, t1: false, t2: false },
                away: { name: '', sl: '', games: 0, def: 0, t1: false, t2: false }
            });
            refresh();
        }
    }

    function update(idx, side, field, val) { matches[idx][side][field] = val; localStorage.setItem('billiardProSession', JSON.stringify(matches)); }
    function updatePoints(idx, field, val) { matches[idx][field] = val; refresh(); }
    function stepMatch(idx, field, d) { matches[idx][field] = Math.max(0, matches[idx][field] + d); refresh(); }
    function step(idx, side, field, d) { matches[idx][side][field] = Math.max(0, matches[idx][side][field] + d); refresh(); }
    function toggleT(idx, side, tKey) { matches[idx][side][tKey] = !matches[idx][side][tKey]; refresh(); }

    function exportText() {
        let log = "MATCH SUMMARY\\n";
        matches.forEach((m, i) => {
            log += `M${i+1}: ${m.home.name} vs ${m.away.name} | Inn: ${m.innings} | Score: ${m.homePoints}-${m.awayPoints}\\n`;
        });
        navigator.clipboard.writeText(log); alert("Copied!");
    }

    function exportJPG() {
        html2canvas(document.getElementById('capture-area')).then(canvas => {
            const link = document.createElement('a');
            link.download = 'league_night.jpg';
            link.href = canvas.toDataURL();
            link.click();
        });
    }

    function clearAll() { if(confirm("Reset all?")) { matches = []; refresh(); } }
    refresh();
</script>
</body>
</html>