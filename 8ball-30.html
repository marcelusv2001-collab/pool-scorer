<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>8 ball 10 pts Scorekeeper</title>
    <style>
        :root {
            --lime: #CCFF00; --bg: #050505; --home: #00E5FF; --away: #FF007F; --card: #121212;
            --bg-r1: rgba(0, 229, 255, 0.05); 
            --bg-r2: rgba(255, 0, 127, 0.05); 
            --bg-r3: rgba(204, 255, 0, 0.05); 
        }
        * { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body {
            background: var(--bg); color: #fff; margin: 0; padding: 2px;
            height: 100vh; display: flex; flex-direction: column;
            border: 2px solid var(--lime); overflow: hidden;
        }
        .series-header {
            background: #1a1a1a; border-bottom: 2px solid var(--lime);
            display: flex; justify-content: space-around; align-items: center;
            padding: 2px; flex-shrink: 0;
        }
        .view-controls { display: flex; justify-content: center; gap: 4px; padding: 4px; background: #111; flex-shrink: 0; }
        .view-btn { background: #333; color: #fff; border: 1px solid var(--lime); padding: 2px 8px; border-radius: 4px; font-size: 0.65rem; font-weight: 800; }
        .view-btn.active { background: var(--lime); color: #000; }
        .match-box { background: #000; padding: 0px 8px; border-radius: 6px; border: 1px solid #333; font-size: 1.5rem; font-weight: 900; }
        
        .main-content { flex: 1; display: flex; flex-direction: column; gap: 2px; overflow-y: auto; padding: 0; }
        .team-zone { background: var(--card); border-radius: 8px; padding: 2px; border: 1px solid #222; flex-shrink: 0; display: flex; flex-direction: column; min-height: 46%; }
        .h-accent { border-top: 3px solid var(--home); }
        .a-accent { border-top: 3px solid var(--away); }
        
        .team-header-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1px; }
        .team-name { background: transparent; border: none; font-size: 0.9rem; color: #fff; font-weight: 800; flex: 1; }
        
        .match-pts-pill { color: #555; font-weight: 900; font-size: 0.75rem; padding: 2px 5px; border-radius: 4px; border: 1px solid transparent; }
        .match-pts-pill.complete { color: var(--lime); border-color: var(--lime); background: rgba(204, 255, 0, 0.1); }

        table { width: 100%; border-collapse: collapse; table-layout: fixed; }
        th { color: var(--lime); font-size: 0.45rem; text-transform: uppercase; padding: 1px; }
        td { padding: 0px; vertical-align: middle; border: 1px solid rgba(255,255,255,0.03); }
        
        .col-r1 { background-color: var(--bg-r1); }
        .col-r2 { background-color: var(--bg-r2); }
        .col-r3 { background-color: var(--bg-r3); }
        .hide-col { display: none !important; }

        tfoot { background: #000; }
        .total-row { border-top: 1px solid #444; font-weight: 900; font-size: 0.75rem; text-align: center; height: 24px; color: #777; }
        .total-row.active-total { color: #fff; }
        .total-row .complete-round { color: var(--lime); text-shadow: 0 0 5px var(--lime); }

        .player-input { background: #222; border: 1px solid #333; color: #fff; width: 100%; padding: 2px; font-size: 0.65rem; }
        .voice-btn { background: #333; border: none; color: #fff; padding: 1px 3px; border-radius: 3px; font-size: 0.6rem; }
        select { background: #222; color: #fff; border: 1px solid #444; width: 100%; padding: 2px 0; font-size: 0.8rem; font-weight: 700; text-align: center; }
        .badge-row { display: flex; gap: 1px; margin-top: 1px; }
        .badge-btn { flex: 1; font-size: 0.4rem; padding: 1px 0; border: none; background: #222; color: #FFF; }
        .badge-btn.active { background: var(--lime); color: #000; font-weight: 900; }
        
        .footer { border-top: 2px solid var(--lime); padding: 4px; display: flex; justify-content: space-between; align-items: center; background: #000; flex-shrink: 0; }
        .submit-btn { background: var(--lime); color: #000; padding: 6px 15px; border: none; border-radius: 15px; font-size: 0.8rem; font-weight: 900; }
    </style>
</head>
<body id="swipe-zone">

<div class="series-header">
    <div style="text-align:center"><div id="h-label" style="color:var(--home); font-size:0.5rem">HOME</div><div class="match-box" id="h-series" style="color:var(--home)">0</div></div>
    <div style="color:var(--lime); font-weight:900;">SERIES</div>
    <div style="text-align:center"><div id="a-label" style="color:var(--away); font-size:0.5rem">AWAY</div><div class="match-box" id="a-series" style="color:var(--away)">0</div></div>
</div>

<div class="view-controls">
    <button class="view-btn active" onclick="setView('all', this)">ALL</button>
    <button class="view-btn" onclick="setView(1, this)">RD 1</button>
    <button class="view-btn" onclick="setView(2, this)">RD 2</button>
    <button class="view-btn" onclick="setView(3, this)">RD 3</button>
</div>

<div class="main-content" id="scroll-container">
    <div class="team-zone h-accent">
        <div class="team-header-row">
            <button class="voice-btn" onclick="startVoice('h-title', 'h-label')">üéôÔ∏è</button>
            <input type="text" class="team-name" id="h-title" placeholder="HOME" oninput="document.getElementById('h-label').innerText = this.value">
            <div class="match-pts-pill" id="h-match-pill">MATCH: <span id="h-grand-total">0</span></div>
        </div>
        <table>
            <thead><tr><th style="width:20%">PLAYER</th><th style="width:12%">SL</th><th class="col-r1">R1</th><th class="col-r2">R2</th><th class="col-r3">R3</th><th style="width:12%">HP</th></tr></thead>
            <tbody id="h-body"></tbody>
            <tfoot>
                <tr class="total-row active-total">
                    <td colspan="2">RD HP</td>
                    <td id="h-hpt-1" class="col-r1">0</td><td id="h-hpt-2" class="col-r2">0</td><td id="h-hpt-3" class="col-r3">0</td>
                    <td style="font-size:0.5rem">SUM: <span id="h-hp-sum">0</span></td>
                </tr>
                <tr class="total-row" id="h-total-line">
                    <td colspan="2" style="color:var(--lime)">TOTAL</td>
                    <td id="h-rt-1" class="col-r1">0</td><td id="h-rt-2" class="col-r2">0</td><td id="h-rt-3" class="col-r3">0</td>
                    <td></td>
                </tr>
            </tfoot>
        </table>
    </div>

    <div class="team-zone a-accent">
        <div class="team-header-row">
            <button class="voice-btn" onclick="startVoice('a-title', 'a-label')">üéôÔ∏è</button>
            <input type="text" class="team-name" id="a-title" placeholder="AWAY" oninput="document.getElementById('a-label').innerText = this.value">
            <div class="match-pts-pill" id="a-match-pill">MATCH: <span id="a-grand-total">0</span></div>
        </div>
        <table>
            <thead><tr><th style="width:20%">PLAYER</th><th style="width:12%">SL</th><th class="col-r1">R1</th><th class="col-r2">R2</th><th class="col-r3">R3</th><th style="width:12%">HP</th></tr></thead>
            <tbody id="a-body"></tbody>
            <tfoot>
                <tr class="total-row active-total">
                    <td colspan="2">RD HP</td>
                    <td id="a-hpt-1" class="col-r1">0</td><td id="a-hpt-2" class="col-r2">0</td><td id="a-hpt-3" class="col-r3">0</td>
                    <td style="font-size:0.5rem">SUM: <span id="a-hp-sum">0</span></td>
                </tr>
                <tr class="total-row" id="a-total-line">
                    <td colspan="2" style="color:var(--lime)">TOTAL</td>
                    <td id="a-rt-1" class="col-r1">0</td><td id="a-rt-2" class="col-r2">0</td><td id="a-rt-3" class="col-r3">0</td>
                    <td></td>
                </tr>
            </tfoot>
        </table>
    </div>
</div>

<div class="footer">
    <button onclick="location.reload()" style="background:#333; color:#fff; border:none; padding:4px; border-radius:6px; font-size:0.6rem">RESET</button>
    <div style="font-weight:900; font-size: 1rem; color: #FFF;" id="live-final-display">0 - 0</div>
    <button class="submit-btn" onclick="processMatch()">SUBMIT</button>
</div>

<div id="summary-layer" style="position:fixed; top:0; left:0; width:100%; height:100%; background:#000; display:none; z-index:1000; padding:10px; flex-direction:column;">
    <div id="tsv-text" style="flex:1; background:#111; color:#0f0; border:1px solid var(--lime); font-family:monospace; font-size:0.7rem; padding:10px; overflow:auto; white-space:pre;"></div>
    <button style="margin-top:10px; padding:15px; background:var(--lime); font-weight:900;" onclick="window.location.href=`sms:?&body=${encodeURIComponent(document.getElementById('tsv-text').innerText)}` transition:0.3s;">TEXT RESULTS</button>
    <button style="margin-top:5px; padding:10px; background:#333; color:#fff;" onclick="document.getElementById('summary-layer').style.display='none'">BACK</button>
</div>

<script>
    function setView(round, btn) {
        document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const r1 = document.querySelectorAll('.col-r1'), r2 = document.querySelectorAll('.col-r2'), r3 = document.querySelectorAll('.col-r3');
        [r1, r2, r3].forEach(l => l.forEach(el => el.classList.add('hide-col')));
        if (round === 'all') [r1, r2, r3].forEach(l => l.forEach(el => el.classList.remove('hide-col')));
        else if (round === 1) r1.forEach(el => el.classList.remove('hide-col'));
        else if (round === 2) r2.forEach(el => el.classList.remove('hide-col'));
        else if (round === 3) r3.forEach(el => el.classList.remove('hide-col'));
    }

    const mpt = () => { let s=""; for(let i=0; i<=10; i++) { if(i===8 || i===9) continue; s+=`<option value="${i}">${i}</option>`; } return s; };
    const msl = () => { let s=""; for(let i=0; i<=10; i++) s+=`<option value="${i}">${i}</option>`; return s; };

    function createUI(side) {
        let rows = ""; let slO = msl(), ptO = mpt();
        for(let i=1; i<=5; i++) {
            rows += `<tr>
                <td><input type="text" class="player-input" id="${side}-n-${i}" placeholder="P${i}"></td>
                <td><select id="${side}-sl-${i}" onchange="calcHandicap()">${slO}</select></td>
                ${[1,2,3].map(r => `<td class="col-r${r}">
                    <select class="${side}-pts-r${r}" id="${side}-r${r}-${i}" onchange="handleScoreChange('${side}', ${r}, ${i}, this.value)">${ptO}</select>
                    <div class="badge-row">
                        <button class="badge-btn b8" onclick="toggleBadge(this, '${side}-r${r}-${i}', '${side}', ${r}, ${i})">8</button>
                        <button class="badge-btn be" onclick="toggleBadge(this, '${side}-r${r}-${i}', '${side}', ${r}, ${i})">E</button>
                    </div>
                </td>`).join('')}
                <td id="${side}-hp-${i}" style="text-align:center; font-weight:900; font-size:0.8rem">0</td>
            </tr>`;
        }
        document.getElementById(side+'-body').innerHTML = rows;
    }

    function toggleBadge(btn, selId, side, round, index) {
        const isAct = btn.classList.contains('active');
        btn.parentElement.querySelectorAll('.badge-btn').forEach(b => b.classList.remove('active'));
        if (!isAct) {
            btn.classList.add('active');
            document.getElementById(selId).value = 10;
            handleScoreChange(side, round, index, 10);
        }
    }

    function handleScoreChange(side, round, index, value) {
        const oppSide = side === 'h' ? 'a' : 'h';
        const oppEl = document.getElementById(`${oppSide}-r${round}-${index}`);
        if (parseInt(value) === 10 && parseInt(oppEl.value) === 10) oppEl.value = 0;
        else if (parseInt(value) < 10 && parseInt(value) >= 0) oppEl.value = 10;
        updateLiveTotals();
    }

    function calcHandicap() {
        for(let i=1; i<=5; i++) {
            let h = parseInt(document.getElementById(`h-sl-${i}`).value), a = parseInt(document.getElementById(`a-sl-${i}`).value);
            document.getElementById(`h-hp-${i}`).innerText = (h-a) < 0 ? Math.min(Math.abs(h-a), 3) : "0";
            document.getElementById(`a-hp-${i}`).innerText = (h-a) > 0 ? Math.min(h-a, 3) : "0";
        }
        ['h','a'].forEach(p => {
            let pHP = 0; for(let i=1; i<=5; i++) pHP += parseInt(document.getElementById(`${p}-hp-${i}`).innerText);
            [1,2,3].forEach(r => document.getElementById(`${p}-hpt-${r}`).innerText = pHP);
            document.getElementById(`${p}-hp-sum`).innerText = pHP * 3;
        });
        updateLiveTotals();
    }

    function updateLiveTotals() {
        let hSeriesScore = 0, aSeriesScore = 0;
        let matchComplete = true;

        for(let r=1; r<=3; r++) {
            let hPlayerPts = 0, aPlayerPts = 0, rFilled = true;
            for(let i=1; i<=5; i++) {
                let hv = document.getElementById(`h-r${r}-${i}`).value;
                let av = document.getElementById(`a-r${r}-${i}`).value;
                if(hv == "0" && av == "0") { rFilled = false; matchComplete = false; }
                hPlayerPts += parseInt(hv); aPlayerPts += parseInt(av);
            }
            
            let hHP = parseInt(document.getElementById(`h-hpt-${r}`).innerText);
            let aHP = parseInt(document.getElementById(`a-hpt-${r}`).innerText);
            
            // UI display: Show Player Pts + HP
            document.getElementById(`h-rt-${r}`).innerText = hPlayerPts + hHP;
            document.getElementById(`a-rt-${r}`).innerText = aPlayerPts + aHP;

            // Trigger series point for round if filled
            if(rFilled) {
                document.getElementById(`h-rt-${r}`).classList.add('complete-round');
                document.getElementById(`a-rt-${r}`).classList.add('complete-round');
                if((hPlayerPts + hHP) > (aPlayerPts + aHP)) hSeriesScore++;
                else if((aPlayerPts + aHP) > (hPlayerPts + hHP)) aSeriesScore++;
            } else {
                document.getElementById(`h-rt-${r}`).classList.remove('complete-round');
                document.getElementById(`a-rt-${r}`).classList.remove('complete-round');
            }
        }

        // Final Match Totals (Series Pt 4)
        const hGrand = [...document.querySelectorAll('#h-total-line td[id^="h-rt-"]')].reduce((a,b)=>a+parseInt(b.innerText),0);
        const aGrand = [...document.querySelectorAll('#a-total-line td[id^="a-rt-"]')].reduce((a,b)=>a+parseInt(b.innerText),0);
        document.getElementById('h-grand-total').innerText = hGrand;
        document.getElementById('a-grand-total').innerText = aGrand;

        if(matchComplete) {
            document.getElementById('h-match-pill').classList.add('complete');
            document.getElementById('a-match-pill').classList.add('complete');
            if(hGrand > aGrand) hSeriesScore++;
            else if(aGrand > hGrand) aSeriesScore++;
        } else {
            document.getElementById('h-match-pill').classList.remove('complete');
            document.getElementById('a-match-pill').classList.remove('complete');
        }

        document.getElementById('h-series').innerText = hSeriesScore;
        document.getElementById('a-series').innerText = aSeriesScore;
        document.getElementById('live-final-display').innerText = `${hGrand} - ${aGrand}`;
    }

    function processMatch() {
        let report = `SERIES: ${document.getElementById('h-series').innerText} - ${document.getElementById('a-series').innerText}\n`;
        report += `TOTAL POINTS: ${document.getElementById('live-final-display').innerText}\n`;
        document.getElementById('tsv-text').innerText = report;
        document.getElementById('summary-layer').style.display = 'flex';
    }

    createUI('h'); createUI('a');
</script>
</body>
</html>
