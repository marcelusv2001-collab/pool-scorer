<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MVP TV APA 8-Ball Pro</title>
    <script src="https://cdnjs.cloudflare.com"></script>
    <style>
        :root { --felt: #2d5a27; --slate: #1a1a1a; --gold: #f1c40f; --ball-8: #2c3e50; --danger: #e74c3c; --app-bg: #ffebee; }
        * { box-sizing: border-box; touch-action: manipulation; -webkit-user-select: none; }
        body { font-family: 'Inter', sans-serif; background-color: var(--slate); margin: 0; padding: 10px; color: #333; }
        .branding { text-align: center; margin-bottom: 5px; }
        .logo-box { background: white; padding: 5px 15px; display: inline-block; border-radius: 12px; }
        .logo-mvp { color:#00FF00; font-size: 24px; font-weight: 900; }
        .logo-tv { color:#FF0000; font-size: 32px; font-style: italic; font-weight: 900; font-family: 'Brush Script MT', cursive; margin-left: -5px; }
        .app-subtitle { display: block; color: #fff; font-weight: 700; font-size: 0.8rem; margin-top: 5px; text-transform: uppercase; }
        .app-container { background: var(--app-bg); border-radius: 15px; padding: 15px; max-width: 600px; margin: auto; width: 100%; min-height: 85vh; }
        .team-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        .team-box { background: rgba(0,0,0,0.05); padding: 8px; border-radius: 8px; }
        .team-input { width:100%; border:none; border-bottom:2px solid var(--gold); background:transparent; font-weight:900; color:var(--ball-8); margin-bottom:5px; text-align:center; }
        .btn-8ball { background: var(--ball-8); color: white; border: none; border-radius: 50%; width: 55px; height: 55px; font-weight: 900; display: flex; flex-direction: column; justify-content: center; align-items: center; cursor: pointer; }
        .btn-8ball.win { background: var(--felt); width: 70px; height: 70px; border: 3px solid #fff; }
        .controls-grid { display: grid; grid-template-columns: 1fr auto 1fr; gap: 15px; margin: 10px 0; align-items: center; }
        .view-all-screen { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: var(--slate); z-index: 1000; padding: 20px; overflow-y: auto; }
        .match-card { background: white; border-radius: 10px; padding: 10px; margin-bottom: 10px; color: #333; }
        #win-modal, #edit-modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); justify-content: center; align-items: center; }
        .modal-content { background: var(--app-bg); padding: 20px; border-radius: 15px; width: 90%; max-width: 320px; text-align: center; }
        .win-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .win-opt { background: var(--ball-8); color: white; padding: 12px; border: none; border-radius: 8px; font-weight: bold; }
    </style>
</head>
<body>

<div class="branding">
    <div class="logo-box"><span class="logo-mvp">MVP</span><span class="logo-tv">TV</span></div>
    <span class="app-subtitle">8 Ball 3 Pt. Offline Scorekeeper</span>
</div>

<div class="app-container" id="capture-area">
    <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
        <span style="font-weight:900;">MATCH <span id="match-num">1</span>/5</span>
        <button class="win-opt" style="padding:4px 10px; font-size:0.7rem;" onclick="showViewAll()">VIEW ALL</button>
    </div>

    <div class="team-grid">
        <div class="team-box">
            <input type="text" id="h-team" class="team-input" placeholder="HOME TEAM">
            <input type="text" id="h-player" placeholder="Player Name" style="width:100%; border:none; background:transparent;">
            <select id="h-sl" onchange="updateRace()" style="width:100%;"><option value="2">SL2</option><option value="3">SL3</option><option value="4" selected>SL4</option><option value="5">SL5</option><option value="6">SL6</option><option value="7">SL7</option></select>
        </div>
        <div class="team-box">
            <input type="text" id="a-team" class="team-input" placeholder="AWAY TEAM">
            <input type="text" id="a-player" placeholder="Player Name" style="width:100%; border:none; background:transparent;">
            <select id="a-sl" onchange="updateRace()" style="width:100%;"><option value="2">SL2</option><option value="3">SL3</option><option value="4" selected>SL4</option><option value="5">SL5</option><option value="6">SL6</option><option value="7">SL7</option></select>
        </div>
    </div>

    <div id="main-controls">
        <div class="controls-grid">
            <div style="display:flex; flex-direction:column; gap:12px; align-items:center;">
                <button class="btn-8ball touch-btn" data-side="h" data-type="def">DEF<span id="h-def-cur">0</span></button>
                <button class="btn-8ball touch-btn" data-side="h" data-type="to">T.O.<span id="h-to-cur">0</span></button>
                <button class="btn-8ball win" onclick="openWin('h')">WIN</button>
            </div>
            <div style="text-align:center;">
                <div style="font-size:0.6rem; font-weight:bold;">INNING</div>
                <button class="touch-btn" data-side="both" data-type="inn" id="inn-cur" style="width:60px; height:60px; border-radius:12px; border:3px solid var(--ball-8); background:white; font-weight:900; font-size:1.5rem;">0</button>
            </div>
            <div style="display:flex; flex-direction:column; gap:12px; align-items:center;">
                <button class="btn-8ball touch-btn" data-side="a" data-type="def">DEF<span id="a-def-cur">0</span></button>
                <button class="btn-8ball touch-btn" data-side="a" data-type="to">T.O.<span id="a-to-cur">0</span></button>
                <button class="btn-8ball win" onclick="openWin('a')">WIN</button>
            </div>
        </div>
    </div>

    <div id="log" style="background:white; padding:10px; border-radius:8px; font-family:monospace; font-size:0.75rem; min-height:50px;"></div>
    <div id="post-match-actions" style="display:none; margin-top:10px; gap:5px; display:grid; grid-template-columns:1fr 1fr;">
        <button class="win-opt" style="background:#555;" onclick="openEditMenu()">EDIT GAME</button>
        <button class="win-opt" onclick="finishMatchAndNext()">FINISH MATCH</button>
    </div>
</div>

<div id="view-all-screen" class="view-all-screen">
    <h2 style="color:white; text-align:center;">SESSION OVERVIEW</h2>
    <div id="matches-list"></div>
    <button class="win-opt" style="width:100%; margin-top:20px;" onclick="hideViewAll()">BACK TO CURRENT</button>
</div>

<div id="win-modal"><div class="modal-content"><h3>WIN TYPE</h3><div class="win-grid">
    <button class="win-opt" onclick="confirmWin('Normal')">Normal</button><button class="win-opt" onclick="confirmWin('B&R')">B&R</button><button class="win-opt" onclick="confirmWin('8BB')">8BB</button><button class="win-opt" onclick="confirmWin('E8')">E8</button><button class="win-opt" onclick="confirmWin('S8')">S8</button><button class="win-opt" onclick="confirmWin('WP')">WP</button>
</div><button onclick="document.getElementById('win-modal').style.display='none'" style="margin-top:15px; color:var(--danger); border:none; background:none;">CANCEL</button></div></div>

<div id="edit-modal"><div class="modal-content"><h3>EDIT GAME</h3><div id="edit-list" class="win-grid" style="grid-template-columns:1fr;"></div><button onclick="document.getElementById('edit-modal').style.display='none'" style="margin-top:15px;">CANCEL</button></div></div>

<script>
    const raceChart = { 2:{2:2,3:2,4:2,5:2,6:2,7:2}, 3:{2:3,3:3,4:3,5:3,6:3,7:3}, 4:{2:4,3:4,4:4,5:4,6:4,7:4}, 5:{2:5,3:5,4:5,5:5,6:5,7:5}, 6:{2:6,3:6,4:6,5:6,6:6,7:6}, 7:{2:7,3:7,4:7,5:7,6:7,7:7} };
    let session = [];
    let currentMatchIndex = 0;
    let match = { h: { team: '', name: '', wins: 0, hist: [], def: 0, to: 0, sl: 4 }, a: { team: '', name: '', wins: 0, hist: [], def: 0, to: 0, sl: 4 }, inn: 0, status: 'active' };

    function updateRace() {
        const r = raceChart[parseInt(document.getElementById('h-sl').value)][parseInt(document.getElementById('a-sl').value)];
        match.h.goal = r; match.a.goal = r;
    }

    // Touch logic: Single Tap (+1), Double Tap (-1), Hold (Reset)
    document.querySelectorAll('.touch-btn').forEach(btn => {
        let lastTap = 0, timer;
        btn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            const now = Date.now();
            if (now - lastTap < 300) { clearTimeout(timer); modifyStat(btn.dataset.side, btn.dataset.type, -1); }
            else { timer = setTimeout(() => modifyStat(btn.dataset.side, btn.dataset.type, 'reset'), 600); }
            lastTap = now;
        });
        btn.addEventListener('touchend', () => { clearTimeout(timer); if (Date.now() - lastTap >= 300) modifyStat(btn.dataset.side, btn.dataset.type, 1); });
    });

    function modifyStat(side, type, val) {
        const target = side === 'both' ? match : match[side];
        if (val === 'reset') target[type] = 0; else target[type] = Math.max(0, target[type] + val);
        render();
    }

    function openWin(side) { match.activeSide = side; document.getElementById('win-modal').style.display = 'flex'; }

    function confirmWin(type) {
        if ((type === 'B&R' || type === '8BB') && match.inn > 0) { alert("B&R and 8BB must be 0 innings. Hold inning button to reset."); return; }
        if (type === 'Normal' && match.inn === 0) { alert("Normal wins require at least 1 inning."); return; }
        
        const side = match.activeSide;
        const entry = { type, inn: match.inn, def: match[side].def, to: match[side].to, winner: side };
        match[side].hist.push(entry);
        match[side].wins++;
        match.inn = 0; match.h.def = 0; match.h.to = 0; match.a.def = 0; match.a.to = 0;
        document.getElementById('win-modal').style.display = 'none';
        
        if (match[side].wins >= match[side].goal) {
            match.status = 'finished';
            document.getElementById('main-controls').style.display = 'none';
            document.getElementById('post-match-actions').style.display = 'grid';
        }
        render();
    }

    function render() {
        document.getElementById('inn-cur').innerText = match.inn;
        document.getElementById('h-def-cur').innerText = match.h.def;
        document.getElementById('h-to-cur').innerText = match.h.to;
        document.getElementById('a-def-cur').innerText = match.a.def;
        document.getElementById('a-to-cur').innerText = match.a.to;
        
        const log = document.getElementById('log');
        log.innerHTML = '';
        [...match.h.hist, ...match.a.hist].forEach((g, i) => {
            log.innerHTML += `G${i+1}(${g.type}) ${g.inn}in ${g.def}def ${g.to}to [${g.winner==='h'?'H':'A'}]<br>`;
        });
    }

    function openEditMenu() {
        const list = document.getElementById('edit-list');
        list.innerHTML = '';
        const allGames = [...match.h.hist, ...match.a.hist];
        allGames.forEach((g, i) => {
            const btn = document.createElement('button');
            btn.className = 'win-opt';
            btn.innerText = `Edit Game ${i+1}`;
            btn.onclick = () => {
                const newInn = prompt("Enter new innings:", g.inn);
                if (newInn !== null) { g.inn = parseInt(newInn); render(); }
                document.getElementById('edit-modal').style.display = 'none';
            };
            list.appendChild(btn);
        });
        document.getElementById('edit-modal').style.display = 'flex';
    }

    function finishMatchAndNext() {
        match.h.team = document.getElementById('h-team').value;
        match.a.team = document.getElementById('a-team').value;
        session.push(JSON.parse(JSON.stringify(match)));
        if (session.length < 5) {
            currentMatchIndex++;
            document.getElementById('match-num').innerText = currentMatchIndex + 1;
            match = { h: { team: '', name: '', wins: 0, hist: [], def: 0, to: 0, sl: 4 }, a: { team: '', name: '', wins: 0, hist: [], def: 0, to: 0, sl: 4 }, inn: 0, status: 'active' };
            document.getElementById('main-controls').style.display = 'grid';
            document.getElementById('post-match-actions').style.display = 'none';
            document.getElementById('h-player').value = ''; document.getElementById('a-player').value = '';
            render();
        } else { alert("Session Complete!"); showViewAll(); }
    }

    function showViewAll() {
        const list = document.getElementById('matches-list');
        list.innerHTML = '';
        session.forEach((m, i) => {
            list.innerHTML += `<div class="match-card"><strong>Match ${i+1}:</strong> ${m.h.team} vs ${m.a.team}<br>Winner: ${m.h.wins > m.a.wins ? m.h.name : m.a.name}</div>`;
        });
        document.getElementById('view-all-screen').style.display = 'block';
    }
    function hideViewAll() { document.getElementById('view-all-screen').style.display = 'none'; }
    updateRace();
</script>
</body>
</html>
