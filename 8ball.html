<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>8 Ball 3Pt. Offline Scorekeeper</title>
    <style>
        :root {
            --bg-color: #0a0e14;
            --felt-green: #0d5a32;
            --text-gold: #ffd700;
            --button-blue: #1e3a8a;
            --button-red: #991b1b;
            --card-bg: #161b22;
        }

        body {
            background-color: var(--bg-color);
            color: #fff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 10px;
            user-select: none;
        }

        .container { max-width: 500px; margin: auto; border: 2px solid var(--felt-green); padding: 15px; border-radius: 12px; background: var(--card-bg); }
        h1 { font-size: 1.2rem; text-align: center; color: var(--text-gold); margin: 0 0 10px 0; }
        
        .header-stats { display: flex; justify-content: space-between; font-size: 0.9rem; color: #aaa; margin-bottom: 10px; }
        .row { display: flex; gap: 10px; margin-bottom: 10px; }
        input, select { flex: 1; padding: 8px; border-radius: 5px; border: 1px solid #333; background: #000; color: #fff; }

        .lag-section { display: flex; justify-content: center; gap: 20px; margin-bottom: 10px; }
        .lag-btn { padding: 5px 15px; border-radius: 20px; border: 2px solid #444; cursor: pointer; }
        .lag-btn.active { border-color: var(--text-gold); background: var(--felt-green); }

        .score-display { text-align: center; font-size: 1.1rem; font-weight: bold; margin: 10px 0; color: var(--text-gold); }

        .button-grid { display: grid; grid-template-columns: 1fr 80px 1fr; gap: 10px; align-items: center; }
        .btn-col { display: flex; flex-direction: column; gap: 10px; }
        
        .score-btn { padding: 20px 10px; border: none; border-radius: 8px; color: white; font-weight: bold; cursor: pointer; touch-action: manipulation; }
        .home-btn { background: var(--button-blue); }
        .away-btn { background: var(--button-red); }
        .inn-btn { background: #444; height: 100%; border: 2px solid var(--text-gold); }
        
        .match-points { display: flex; justify-content: space-around; margin-top: 15px; padding: 10px; background: #000; border-radius: 8px; border: 1px solid var(--felt-green); }
        .log-section { margin-top: 15px; font-family: monospace; font-size: 0.85rem; height: 100px; overflow-y: auto; background: #000; padding: 10px; border: 1px solid #333; }

        .footer-btns { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 5px; margin-top: 15px; }
        .footer-btns button { padding: 10px; cursor: pointer; background: #333; color: white; border: none; border-radius: 5px; }
        
        /* Modal for Rack Options */
        #rackModal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); justify-content: center; align-items: center; }
        .modal-content { background: var(--card-bg); padding: 20px; border-radius: 10px; display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .modal-content button { padding: 15px; background: var(--felt-green); color: white; border: none; border-radius: 5px; }
    </style>
</head>
<body>

<div class="container" id="matchWindow">
    <h1>8 Ball 3Pt. Offline Scorekeeper</h1>
    
    <div class="header-stats">
        <span id="raceLabel">(Race 0/0)</span>
        <span id="totalSlLabel">H(0) A(0)</span>
    </div>

    <div class="row">
        <input type="text" id="homeTeam" placeholder="Home Team">
        <input type="text" id="awayTeam" placeholder="Away Team">
    </div>

    <div class="lag-section">
        <div class="lag-btn" onclick="toggleLag('H')" id="lagH">Lag H</div>
        <div class="lag-btn" onclick="toggleLag('A')" id="lagA">Lag A</div>
    </div>

    <div class="row">
        <input type="text" id="homePlayer" placeholder="Home Player">
        <select id="slH" onchange="calculateRace()"><option value="2">SL 2</option><option value="3">SL 3</option><option value="4">SL 4</option><option value="5">SL 5</option><option value="6">SL 6</option><option value="7">SL 7</option></select>
    </div>
    <div class="row">
        <input type="text" id="awayPlayer" placeholder="Away Player">
        <select id="slA" onchange="calculateRace()"><option value="2">SL 2</option><option value="3">SL 3</option><option value="4">SL 4</option><option value="5">SL 5</option><option value="6">SL 6</option><option value="7">SL 7</option></select>
    </div>

    <div class="score-display" id="gwLabel">gw 0/0</div>

    <div class="button-grid">
        <div class="btn-col">
            <button class="score-btn home-btn" onmousedown="handlePress(event, 'toH')" ontouchstart="handlePress(event, 'toH')">TO: <span id="toH">0</span></button>
            <button class="score-btn home-btn" onmousedown="handlePress(event, 'defH')" ontouchstart="handlePress(event, 'defH')">DEF: <span id="defH">0</span></button>
            <button class="score-btn home-btn" onclick="openRack('H')">RACK</button>
        </div>
        
        <button class="score-btn inn-btn" onmousedown="handlePress(event, 'inn')" ontouchstart="handlePress(event, 'inn')">INN<br><span id="inn">0</span></button>

        <div class="btn-col">
            <button class="score-btn away-btn" onmousedown="handlePress(event, 'toA')" ontouchstart="handlePress(event, 'toA')">TO: <span id="toA">0</span></button>
            <button class="score-btn away-btn" onmousedown="handlePress(event, 'defA')" ontouchstart="handlePress(event, 'defA')">DEF: <span id="defA">0</span></button>
            <button class="score-btn away-btn" onclick="openRack('A')">RACK</button>
        </div>
    </div>

    <div class="match-points">
        <span>Home Pts: <span id="matchPtsH">0</span></span>
        <span>Away Pts: <span id="matchPtsA">0</span></span>
    </div>

    <div class="footer-btns">
        <button onclick="endMatch()">End Match</button>
        <button onclick="editMatch()">Edit</button>
        <button onclick="resetMatch()">Reset</button>
        <button onclick="viewAll()" style="grid-column: span 3; background: var(--felt-green);">View All & Start Another</button>
    </div>

    <div class="log-section" id="matchLog">Match Log empty...</div>
</div>

<div id="rackModal">
    <div class="modal-content">
        <button onclick="submitRack('8BB')">8BB</button>
        <button onclick="submitRack('B&R')">B&R</button>
        <button onclick="submitRack('WP')">WP</button>
        <button onclick="submitRack('E8')">E8</button>
        <button onclick="submitRack('S8')">S8</button>
        <button onclick="closeRack()" style="background: #333;">X</button>
    </div>
</div>

<script>
    // Data State
    let state = {
        toH: 0, toA: 0, defH: 0, defA: 0, inn: 0, gwH: 0, gwA: 0,
        needsH: 2, needsA: 2, matchPtsH: 0, matchPtsA: 0,
        gameCount: 1, currentRackSide: 'H'
    };

    // APA 8-Ball Race Chart
    const raceChart = {
        "2": { "2": 2, "3": 2, "4": 2, "5": 2, "6": 2, "7": 2 },
        "3": { "2": 2, "3": 2, "4": 2, "5": 2, "6": 2, "7": 2 },
        "4": { "2": 3, "3": 3, "4": 3, "5": 3, "6": 3, "7": 2 },
        "5": { "2": 4, "3": 4, "4": 4, "5": 4, "6": 3, "7": 3 },
        "6": { "2": 5, "3": 5, "4": 5, "5": 4, "6": 4, "7": 4 },
        "7": { "2": 6, "3": 6, "4": 5, "5": 5, "6": 5, "7": 5 }
    };

    function calculateRace() {
        const h = document.getElementById('slH').value;
        const a = document.getElementById('slA').value;
        state.needsH = raceChart[h][a];
        state.needsA = raceChart[a][h];
        updateUI();
    }

    // 3-Function Logic
    let timer = null;
    function handlePress(e, id) {
        e.preventDefault();
        if (e.detail === 2) { // Double tap
            clearTimeout(timer);
            state[id] = Math.max(0, state[id] - 1);
        } else {
            const longPress = setTimeout(() => {
                state[id] = 0;
                updateUI();
            }, 600);
            
            e.target.onmouseup = e.target.ontouchend = () => {
                clearTimeout(longPress);
                if (e.detail === 1) state[id]++;
                updateUI();
            };
        }
        updateUI();
    }

    function toggleLag(side) {
        document.getElementById('lagH').classList.toggle('active', side === 'H');
        document.getElementById('lagA').classList.toggle('active', side === 'A');
    }

    function openRack(side) { 
        state.currentRackSide = side;
        document.getElementById('rackModal').style.display = 'flex'; 
    }
    
    function closeRack() { document.getElementById('rackModal').style.display = 'none'; }

    function submitRack(type) {
        const side = state.currentRackSide;
        if (side === 'H') state.gwH++; else state.gwA++;
        
        // Log game
        const log = document.getElementById('matchLog');
        if (log.innerHTML.includes('empty')) log.innerHTML = '';
        log.innerHTML += `G${state.gameCount} (${side}) ${type} TO:${state.toH}/${state.toA} D:${state.defH}/${state.defA} INN:${state.inn}<br>`;
        
        state.gameCount++;
        state.defH = 0; state.defA = 0; state.inn = 0; // Reset for next rack
        
        checkMatchEnd();
        closeRack();
        updateUI();
    }

    function checkMatchEnd() {
        if (state.gwH >= state.needsH || state.gwA >= state.needsA) {
            calculateMatchPoints();
            alert("Match complete! Please click End Match to save.");
        }
    }

    function calculateMatchPoints() {
        // Simple 3-point logic placeholder
        if (state.gwH >= state.needsH) { state.matchPtsH = 3; state.matchPtsA = 0; }
        else if (state.gwA >= state.needsA) { state.matchPtsA = 3; state.matchPtsH = 0; }
    }

    function updateUI() {
        document.getElementById('toH').innerText = state.toH;
        document.getElementById('toA').innerText = state.toA;
        document.getElementById('defH').innerText = state.defH;
        document.getElementById('defA').innerText = state.defA;
        document.getElementById('inn').innerText = state.inn;
        document.getElementById('raceLabel').innerText = `(Race ${state.needsH}/${state.needsA})`;
        document.getElementById('gwLabel').innerText = `gw ${state.gwH}/${state.gwA}`;
        document.getElementById('matchPtsH').innerText = state.matchPtsH;
        document.getElementById('matchPtsA').innerText = state.matchPtsA;
    }

    function resetMatch() {
        if(confirm("Reset current match?")) location.reload();
    }

    function endMatch() {
        alert("Match data recorded. Ready for next match.");
        location.reload();
    }

    function viewAll() {
        alert("View All Mode: Current Stats and Match Logs summary would be displayed here.");
    }
</script>
</body>
</html>
