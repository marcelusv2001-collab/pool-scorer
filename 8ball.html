<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>8 Ball 3Pt. Offline Scorekeeper</title>
    <style>
        :root { --bg: #0a0e14; --felt: #0d5a32; --gold: #ffd700; --blue: #1e3a8a; --red: #991b1b; --card: #161b22; }
        body { background: var(--bg); color: #fff; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 10px; touch-action: manipulation; }
        .container { max-width: 450px; margin: auto; border: 2px solid var(--felt); padding: 15px; border-radius: 12px; background: var(--card); box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        h1 { font-size: 1.1rem; text-align: center; color: var(--gold); text-transform: uppercase; margin: 0 0 15px; }
        .row { display: flex; gap: 10px; margin-bottom: 8px; }
        .header-stats { display: flex; justify-content: space-between; font-size: 0.85rem; color: #bbb; margin-bottom: 10px; font-weight: bold; }
        input, select { flex: 1; padding: 10px; border-radius: 5px; border: 1px solid #333; background: #000; color: #fff; font-size: 0.9rem; }
        .lag-btn { flex: 1; padding: 8px; text-align: center; border: 2px solid #444; border-radius: 20px; cursor: pointer; font-size: 0.8rem; font-weight: bold; }
        .lag-btn.active { background: var(--felt); border-color: var(--gold); color: #fff; }
        .score-banner { text-align: center; font-size: 1.3rem; font-weight: 800; margin: 15px 0; color: var(--gold); border-top: 1px solid #333; padding-top: 10px; }
        .grid { display: grid; grid-template-columns: 1fr 80px 1fr; gap: 12px; }
        .btn-stack { display: flex; flex-direction: column; gap: 10px; }
        .score-btn { padding: 22px 5px; border: none; border-radius: 8px; color: white; font-weight: bold; font-size: 1rem; cursor: pointer; box-shadow: 0 4px #000; }
        .h-btn { background: var(--blue); } .a-btn { background: var(--red); }
        .inn-btn { background: #333; border: 2px solid var(--gold); height: 100%; color: var(--gold); }
        .pts-box { display: flex; justify-content: space-around; margin-top: 20px; padding: 12px; background: #000; border-radius: 8px; border: 1px solid var(--felt); font-weight: bold; color: var(--gold); }
        .log { margin-top: 15px; height: 140px; overflow-y: auto; background: #000; padding: 10px; font-size: 0.8rem; border: 1px solid #333; border-radius: 5px; color: #0f0; font-family: monospace; }
        .footer-btns { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 20px; }
        .footer-btns button { padding: 10px; cursor: pointer; background: #333; color: white; border: none; border-radius: 5px; font-weight: bold; font-size: 0.7rem; }
        #modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); justify-content: center; align-items: center; z-index: 100; }
        .m-content { background: var(--card); padding: 20px; border-radius: 15px; border: 2px solid var(--felt); display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; width: 80%; }
        .m-content button { padding: 18px; background: var(--felt); color: #fff; border: none; border-radius: 8px; font-weight: bold; }
    </style>
</head>
<body>
<div class="container">
    <h1>8 Ball 3Pt. Offline Scorekeeper</h1>
    <div class="header-stats"><span id="race">Race: 2/2</span><span id="totalSl">SL Sum: 4</span></div>
    <div class="row"><input type="text" id="hTeam" placeholder="Home Team"><input type="text" id="aTeam" placeholder="Away Team"></div>
    <div class="row"><div class="lag-btn" id="lH" onclick="setLag('H')">LAG HOME</div><div class="lag-btn" id="lA" onclick="setLag('A')">LAG AWAY</div></div>
    <div class="row"><input type="text" id="hPlayer" placeholder="Home Player"><select id="slH" onchange="initRace()"><option value="2">SL 2</option><option value="3">SL 3</option><option value="4">SL 4</option><option value="5">SL 5</option><option value="6">SL 6</option><option value="7">SL 7</option></select></div>
    <div class="row"><input type="text" id="aPlayer" placeholder="Away Player"><select id="slA" onchange="initRace()"><option value="2">SL 2</option><option value="3">SL 3</option><option value="4">SL 4</option><option value="5">SL 5</option><option value="6">SL 6</option><option value="7">SL 7</option></select></div>
    <div class="score-banner" id="gw">GW 0/2 - 0/2</div>
    <div class="grid">
        <div class="btn-stack">
            <button class="score-btn h-btn" onmousedown="handle(event, 'toH')" ontouchstart="handle(event, 'toH')">TO: <span id="toH">0</span></button>
            <button class="score-btn h-btn" onmousedown="handle(event, 'defH')" ontouchstart="handle(event, 'defH')">DEF: <span id="defH">0</span></button>
            <button class="score-btn h-btn" onclick="openRack('H')">RACK</button>
        </div>
        <button class="score-btn inn-btn" onmousedown="handle(event, 'inn')" ontouchstart="handle(event, 'inn')">INN<br><span id="inn">0</span></button>
        <div class="btn-stack">
            <button class="score-btn a-btn" onmousedown="handle(event, 'toA')" ontouchstart="handle(event, 'toA')">TO: <span id="toA">0</span></button>
            <button class="score-btn a-btn" onmousedown="handle(event, 'defA')" ontouchstart="handle(event, 'defA')">DEF: <span id="defA">0</span></button>
            <button class="score-btn a-btn" onclick="openRack('A')">RACK</button>
        </div>
    </div>
    <div class="pts-box"><span>HOME Pts: <span id="ptsH">0</span></span><span>AWAY Pts: <span id="ptsA">0</span></span></div>
    <div class="footer-btns">
        <button onclick="endMatch()">End Match</button><button onclick="editMatch()">Edit</button><button onclick="resetMatch()">Reset</button>
        <button onclick="viewAll()" style="grid-column: span 3; background: var(--felt); border: 1px solid var(--gold);">View All & Start Another</button>
    </div>
    <div class="log" id="matchLog">MATCH LOG: Ready...</div>
</div>
<div id="modal"><div class="m-content" id="mBtns"></div></div>

<script>
const officialRace = {
    2: {2:[2,2], 3:[2,2], 4:[2,3], 5:[2,4], 6:[2,5], 7:[2,6]},
    3: {2:[2,2], 3:[2,2], 4:[2,3], 5:[2,4], 6:[2,5], 7:[2,6]},
    4: {2:[3,2], 3:[3,2], 4:[3,3], 5:[3,4], 6:[3,5], 7:[2,5]},
    5: {2:[4,2], 3:[4,2], 4:[4,3], 5:[4,4], 6:[4,5], 7:[3,5]},
    6: {2:[5,2], 3:[5,2], 4:[5,3], 5:[5,4], 6:[5,5], 7:[4,5]},
    7: {2:[6,2], 3:[6,2], 4:[5,2], 5:[5,3], 6:[5,4], 7:[5,5]}
};

let data = { toH:0, toA:0, defH:0, defA:0, inn:0, gwH:0, gwA:0, reqH:2, reqA:2, activeSide:'' };
let clickTimer = null;

function initRace() {
    const slH = parseInt(document.getElementById('slH').value), slA = parseInt(document.getElementById('slA').value);
    [data.reqH, data.reqA] = officialRace[slH][slA];
    document.getElementById('race').innerText = `Race: ${data.reqH}/${data.reqA}`;
    document.getElementById('totalSl').innerText = `SL Sum: ${slH + slA}`;
    updateUI();
}

function handle(e, key) {
    e.preventDefault();
    if (key.includes('to')) {
        const sl = key === 'toH' ? parseInt(document.getElementById('slH').value) : parseInt(document.getElementById('slA').value);
        const limit = sl <= 3 ? 2 : 1; 
        if (clickTimer === null && data[key] >= limit && e.type !== 'touchstart') { alert(`Limit ${limit} reached!`); return; }
    }
    if (clickTimer) { clearTimeout(clickTimer); clickTimer = null; data[key] = Math.max(0, data[key] - 1); } 
    else {
        const lp = setTimeout(() => { data[key] = 0; updateUI(); clickTimer = null; }, 600);
        clickTimer = setTimeout(() => { if (clickTimer) { data[key]++; updateUI(); clickTimer = null; } }, 250);
        e.target.onmouseup = e.target.ontouchend = () => clearTimeout(lp);
    }
    updateUI();
}

function openRack(side) {
    data.activeSide = side; document.getElementById('modal').style.display = 'flex';
    document.getElementById('mBtns').innerHTML = ['Win','8BB','B&R','WP','E8','S8','CANCEL'].map(opt => 
        `<button onclick="submitRack('${opt}')">${opt}</button>`).join('');
}

function submitRack(type) {
    if(type === 'CANCEL') { document.getElementById('modal').style.display = 'none'; return; }
    let inningMarked = (type === '8BB' || type === 'B&R') ? 0 : data.inn;
    if(data.activeSide === 'H') data.gwH++; else data.gwA++;
    const log = document.getElementById('matchLog');
    if(log.innerText.includes('Ready')) log.innerHTML = '';
    log.innerHTML += `> G${data.gwH+data.gwA}: (${data.activeSide}) ${type} | INN:${inningMarked} | D:${data.defH}/${data.defA}<br>`;
    data.defH = 0; data.defA = 0; data.inn = 0; data.toH = 0; data.toA = 0;
    calcMatchPts(); updateUI();
    document.getElementById('modal').style.display = 'none';
}

function calcMatchPts() {
    let pH = 0, pA = 0;
    if (data.gwH >= data.reqH) {
        if (data.gwA === 0) { pH = 3; pA = 0; } 
        else if (data.gwA === data.reqA - 1) { pH = 2; pA = 1; } 
        else { pH = 2; pA = 0; }
    } else if (data.gwA >= data.reqA) {
        if (data.gwH === 0) { pA = 3; pH = 0; }
        else if (data.gwH === data.reqH - 1) { pA = 2; pH = 1; }
        else { pA = 2; pH = 0; }
    }
    document.getElementById('ptsH').innerText = pH; document.getElementById('ptsA').innerText = pA;
}

function setLag(s) { document.getElementById('lH').classList.remove('active'); document.getElementById('lA').classList.remove('active'); document.getElementById('l' + s).classList.add('active'); }
function updateUI() {
    ['toH','toA','defH','defA','inn'].forEach(k => document.getElementById(k).innerText = data[k]);
    document.getElementById('gw').innerText = `GW ${data.gwH}/${data.reqH} - ${data.gwA}/${data.reqA}`;
}

function endMatch() { alert("Match Ended and Points Recorded!"); location.reload(); }
function resetMatch() { if(confirm("Reset current match data?")) location.reload(); }
function editMatch() { alert("Edit mode: Tap individual values or log entries to adjust."); }
function viewAll() { alert("Showing current session summary..."); }

initRace();
</script>
</body>
</html>
