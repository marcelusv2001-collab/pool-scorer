<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>8 Ball 3 Pt. Offline Scorekeeper</title>
    <script src="https://cdnjs.cloudflare.com"></script>
    <style>
        :root { --felt: #2d5a27; --slate: #1a1a1a; --gold: #f1c40f; --ball-8: #2c3e50; --danger: #e74c3c; --app-bg: #ffebee; }
        * { box-sizing: border-box; touch-action: manipulation; -webkit-user-select: none; }
        body { font-family: 'Inter', sans-serif; background-color: var(--slate); margin: 0; padding: 10px; color: #333; }
        .branding { text-align: center; margin-bottom: 5px; }
        .logo-box { background: white; padding: 5px 15px; display: inline-block; border-radius: 12px; }
        .logo-mvp { color:#00FF00; font-size: 24px; font-weight: 900; }
        .logo-tv { color:#FF0000; font-size: 32px; font-style: italic; font-weight: 900; font-family: 'Brush Script MT', cursive; margin-left: -5px; }
        .app-subtitle { display: block; color: #fff; font-weight: 700; font-size: 0.8rem; margin-top: 5px; text-transform: uppercase; }
        .app-container { background: var(--app-bg); border-radius: 15px; padding: 15px; max-width: 600px; margin: auto; width: 100%; min-height: 85vh; position: relative; }
        .team-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        .team-box { background: rgba(0,0,0,0.05); padding: 8px; border-radius: 8px; }
        .team-input { width:100%; border:none; border-bottom:2px solid var(--gold); background:transparent; font-weight:900; color:var(--ball-8); text-align:center; margin-bottom:5px; }
        .btn-8ball { background: var(--ball-8); color: white; border: none; border-radius: 50%; width: 55px; height: 55px; font-weight: 900; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .btn-8ball.win { background: var(--felt); width: 70px; height: 70px; border: 3px solid #fff; }
        .controls-grid { display: grid; grid-template-columns: 1fr auto 1fr; gap: 15px; margin: 10px 0; align-items: center; }
        .modal { display: none; position: fixed; z-index: 200; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); justify-content: center; align-items: center; }
        .modal-content { background: var(--app-bg); padding: 20px; border-radius: 15px; width: 90%; max-width: 350px; text-align: center; max-height: 80vh; overflow-y: auto; }
        .win-opt { background: var(--ball-8); color: white; padding: 10px; border: none; border-radius: 8px; font-weight: bold; width: 100%; margin: 4px 0; cursor: pointer; }
    </style>
</head>
<body>

<div class="branding">
    <div class="logo-box"><span class="logo-mvp">MVP</span><span class="logo-tv">TV</span></div>
    <span class="app-subtitle">8 Ball 3 Pt. Offline Scorekeeper</span>
</div>

<div class="app-container" id="capture-area">
    <div style="display:flex; justify-content:space-between; margin-bottom:10px; font-weight:900; font-size:0.8rem;">
        <span>MATCH <span id="match-num">1</span>/5 â€” <span id="race-display">RACE 0-0</span></span>
    </div>

    <div class="team-grid">
        <div class="team-box">
            <input type="text" id="h-team" class="team-input" placeholder="HOME TEAM">
            <input type="text" id="h-player" placeholder="Player Name" style="width:100%; border:none; background:transparent; font-weight:bold;">
            <select id="h-sl" onchange="updateRace()"><option value="2">SL2</option><option value="3">SL3</option><option value="4" selected>SL4</option><option value="5">SL5</option><option value="6">SL6</option><option value="7">SL7</option></select>
        </div>
        <div class="team-box">
            <input type="text" id="a-team" class="team-input" placeholder="AWAY TEAM">
            <input type="text" id="a-player" placeholder="Player Name" style="width:100%; border:none; background:transparent; font-weight:bold;">
            <select id="a-sl" onchange="updateRace()"><option value="2">SL2</option><option value="3">SL3</option><option value="4" selected>SL4</option><option value="5">SL5</option><option value="6">SL6</option><option value="7">SL7</option></select>
        </div>
    </div>

    <div class="controls-grid">
        <div style="display:flex; flex-direction:column; gap:12px; align-items:center;">
            <button class="btn-8ball touch-btn" data-side="h" data-type="def">DEF<span id="h-def-cur">0</span></button>
            <button class="btn-8ball touch-btn" data-side="h" data-type="to">T.O.<span id="h-to-cur">0</span></button>
            <button class="btn-8ball win" onclick="openWin('h')">WIN</button>
        </div>
        <div style="text-align:center;">
            <div style="font-size:0.6rem; font-weight:bold;">INNING</div>
            <button class="touch-btn" data-side="both" data-type="inn" id="inn-cur" style="width:60px; height:60px; border-radius:12px; border:3px solid var(--ball-8); background:white; font-weight:900; font-size:1.5rem;">0</button>
        </div>
        <div style="display:flex; flex-direction:column; gap:12px; align-items:center;">
            <button class="btn-8ball touch-btn" data-side="a" data-type="def">DEF<span id="a-def-cur">0</span></button>
            <button class="btn-8ball touch-btn" data-side="a" data-type="to">T.O.<span id="a-to-cur">0</span></button>
            <button class="btn-8ball win" onclick="openWin('a')">WIN</button>
        </div>
    </div>

    <div id="log" style="background:white; padding:10px; border-radius:8px; font-family:monospace; font-size:0.75rem; min-height:80px; border:1px solid #ddd;"></div>
</div>

<div id="win-modal" class="modal"><div class="modal-content"><h3>WIN TYPE</h3><div id="win-opts"></div><button onclick="document.getElementById('win-modal').style.display='none'" style="margin-top:10px; color:var(--danger); border:none; background:none;">CANCEL</button></div></div>

<script>
    // Official APA Race Chart [Home SL][Away SL]
    const raceChart = {
        2: { 2: 2, 3: 2, 4: 2, 5: 2, 6: 2, 7: 2 },
        3: { 2: 3, 3: 2, 4: 2, 5: 2, 6: 2, 7: 2 },
        4: { 2: 4, 3: 3, 4: 3, 5: 3, 6: 3, 7: 2 },
        5: { 2: 5, 3: 4, 4: 4, 5: 4, 6: 4, 7: 3 },
        6: { 2: 6, 3: 5, 4: 5, 5: 5, 6: 5, 7: 4 },
        7: { 2: 7, 3: 6, 4: 5, 5: 5, 6: 5, 7: 5 }
    };

    let match = { h: { wins: 0, def: 0, to: 0, sl: 4 }, a: { wins: 0, def: 0, to: 0, sl: 4 }, inn: 0, hist: [] };

    function updateRace() {
        const hSL = parseInt(document.getElementById('h-sl').value), aSL = parseInt(document.getElementById('a-sl').value);
        match.h.goal = raceChart[hSL][aSL]; match.a.goal = raceChart[aSL][hSL];
        document.getElementById('race-display').innerText = `RACE ${match.h.goal}-${match.a.goal}`;
    }

    document.querySelectorAll('.touch-btn').forEach(btn => {
        let lastTap = 0, timer;
        btn.addEventListener('touchstart', (e) => {
            e.preventDefault(); const now = Date.now();
            if (now - lastTap < 300) { clearTimeout(timer); mod(btn.dataset.side, btn.dataset.type, -1); }
            else { timer = setTimeout(() => mod(btn.dataset.side, btn.dataset.type, 'reset'), 600); }
            lastTap = now;
        });
        btn.addEventListener('touchend', () => { clearTimeout(timer); if (Date.now() - lastTap >= 300) mod(btn.dataset.side, btn.dataset.type, 1); });
    });

    function mod(s, t, v) { 
        const obj = s === 'both' ? match : match[s];
        if (v === 'reset') obj[t] = 0; else obj[t] = Math.max(0, obj[t] + v);
        render();
    }

    function openWin(side) {
        match.activeSide = side;
        const opts = ['Normal', 'B&R', '8BB', 'E8', 'S8', 'WP'];
        document.getElementById('win-opts').innerHTML = opts.map(o => `<button class="win-opt" onclick="confirmWin('${o}')">${o}</button>`).join('');
        document.getElementById('win-modal').style.display = 'flex';
    }

    function confirmWin(type) {
        if ((type === 'B&R' || type === '8BB') && match.inn > 0) return alert("B&R/8BB must be 0 innings!");
        if (type === 'Normal' && match.inn === 0) return alert("Normal win requires >0 innings!");
        
        const side = match.activeSide;
        match.hist.push(`g${match.h.wins+match.a.wins+1}(${type}) ${match.inn}in ${match[side].def}def ${match[side].to}to`);
        match[side].wins++;
        match.inn = 0; match.h.def = 0; match.h.to = 0; match.a.def = 0; match.a.to = 0;
        document.getElementById('win-modal').style.display = 'none';
        render();
    }

    function render() {
        document.getElementById('h-def-cur').innerText = match.h.def;
        document.getElementById('h-to-cur').innerText = match.h.to;
        document.getElementById('a-def-cur').innerText = match.a.def;
        document.getElementById('a-to-cur').innerText = match.a.to;
        document.getElementById('inn-cur').innerText = match.inn;
        document.getElementById('log').innerHTML = match.hist.join('<br>');
    }

    updateRace();
</script>
</body>
</html>
