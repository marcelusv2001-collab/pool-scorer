<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APA 8-Ball Team Scorekeeper</title>
    <style>
        :root { --apa-blue: #004a99; --apa-yellow: #ffcc00; --danger: #ff4444; }
        body { font-family: 'Segoe UI', sans-serif; background: #1a1a1a; color: #333; padding: 10px; display: flex; flex-direction: column; align-items: center; }
        .card { background: white; width: 100%; max-width: 500px; border-radius: 8px; margin-bottom: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.5); overflow: hidden; }
        .header { background: var(--apa-blue); color: white; padding: 12px; text-align: center; }
        .summary-bar { background: #333; color: white; display: flex; justify-content: space-around; padding: 10px; font-weight: bold; }
        .over-limit { color: var(--danger); text-decoration: underline; }
        .match-box { padding: 15px; border-bottom: 5px solid #eee; }
        .grid-3 { display: grid; grid-template-columns: 2fr 1fr 1.5fr; gap: 8px; margin-bottom: 8px; }
        .grid-4 { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 5px; background: #f4f4f4; padding: 8px; border-radius: 4px; }
        label { font-size: 0.65rem; font-weight: bold; color: #777; display: block; text-transform: uppercase; }
        input { width: 100%; padding: 6px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: 0.9rem; }
        .btn-inc { background: var(--apa-blue); color: white; border: none; padding: 4px; border-radius: 4px; cursor: pointer; font-size: 0.7rem; margin-bottom: 2px; width: 100%; }
        .pts-out { font-weight: bold; color: var(--apa-blue); text-align: center; background: #eef; }
        .vs-label { text-align: center; font-size: 0.7rem; font-weight: bold; margin: 4px 0; color: #999; }
        .footer-btns { width: 100%; max-width: 500px; display: flex; gap: 10px; }
        button.reset { background: var(--danger); color: white; border: none; padding: 12px; border-radius: 8px; flex: 1; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div class="card">
    <div class="header">
        <h3 style="margin:0">APA TEAM SCOREBOARD</h3>
    </div>
    <div class="summary-bar">
        <div>TEAM SL: <span id="total-sl">0</span> / 23</div>
        <div>TOTAL PTS: <span id="total-pts">0</span></div>
    </div>
</div>

<div id="match-list" style="width:100%; max-width:500px;">
    <!-- Generate 5 Match Slots -->
    <script>
        for(let i=1; i<=5; i++) {
            document.write(`
            <div class="card match-box">
                <div style="font-size:0.8rem; font-weight:bold; margin-bottom:10px; color:var(--apa-blue)">MATCH #${i}</div>
                <div class="grid-3">
                    <div><label>Player</label><input type="text" id="m${i}p1_n" class="store" placeholder="Home"></div>
                    <div><label>SL</label><input type="number" id="m${i}p1_sl" class="store sl-input" min="2" max="7"></div>
                    <div><label>Result</label><input type="text" id="m${i}p1_pts" class="pts-out" readonly placeholder="Pts"></div>
                </div>
                <div class="grid-4">
                    <div><label>Wins</label><input type="number" id="m${i}p1_w" class="store win-input" value="0"></div>
                    <div><label>Innings</label><button class="btn-inc" onclick="inc('m${i}p1_i')">+1</button><input type="number" id="m${i}p1_i" class="store" value="0"></div>
                    <div><label>Def.</label><input type="number" id="m${i}p1_d" class="store" value="0"></div>
                    <div><label>Must Win</label><input type="text" id="m${i}p1_mw" style="background:#eee" readonly></div>
                </div>

                <div class="vs-label">— VS —</div>

                <div class="grid-3">
                    <div><input type="text" id="m${i}p2_n" class="store" placeholder="Opponent"></div>
                    <div><input type="number" id="m${i}p2_sl" class="store sl-input" min="2" max="7"></div>
                    <div><input type="text" id="m${i}p2_pts" class="pts-out" readonly placeholder="Pts"></div>
                </div>
                <div class="grid-4">
                    <div><input type="number" id="m${i}p2_w" class="store win-input" value="0"></div>
                    <div><button class="btn-inc" onclick="inc('m${i}p2_i')">+1</button><input type="number" id="m${i}p2_i" class="store" value="0"></div>
                    <div><input type="number" id="m${i}p2_d" class="store" value="0"></div>
                    <div><input type="text" id="m${i}p2_mw" style="background:#eee" readonly></div>
                </div>
            </div>
            `);
        }
    </script>
</div>

<div class="footer-btns">
    <button class="reset" onclick="resetAll()">Clear Full Night</button>
</div>

<script>
    const mwTable = {
        2: {2:2, 3:2, 4:2, 5:2, 6:2, 7:2}, 3: {2:3, 3:2, 4:2, 5:2, 6:2, 7:2},
        4: {2:4, 3:3, 4:3, 5:3, 6:3, 7:2}, 5: {2:5, 3:4, 4:4, 5:4, 6:4, 7:3},
        6: {2:6, 3:5, 4:5, 5:5, 6:5, 7:4}, 7: {2:7, 3:6, 4:5, 5:5, 6:5, 7:5}
    };

    function calculate() {
        let grandTotalSL = 0;
        let grandTotalPts = 0;

        for(let i=1; i<=5; i++) {
            let sl1 = parseInt(document.getElementById(`m${i}p1_sl`).value);
            let sl2 = parseInt(document.getElementById(`m${i}p2_sl`).value);
            let w1 = parseInt(document.getElementById(`m${i}p1_w`).value) || 0;
            let w2 = parseInt(document.getElementById(`m${i}p2_w`).value) || 0;

            if(sl1) grandTotalSL += sl1;

            if(sl1 && sl2) {
                let mw1 = mwTable[sl1][sl2];
                let mw2 = mwTable[sl2][sl1];
                document.getElementById(`m${i}p1_mw`).value = mw1;
                document.getElementById(`m${i}p2_mw`).value = mw2;

                if(w1 >= mw1) {
                    let p = (w2 > 0) ? 2 : 3;
                    document.getElementById(`m${i}p1_pts`).value = p;
                    document.getElementById(`m${i}p2_pts`).value = 0;
                    grandTotalPts += p;
                } else if(w2 >= mw2) {
                    let p = (w1 > 0) ? 2 : 3;
                    document.getElementById(`m${i}p2_pts`).value = p;
                    document.getElementById(`m${i}p1_pts`).value = 0;
                } else {
                    document.getElementById(`m${i}p1_pts`).value = "";
                    document.getElementById(`m${i}p2_pts`).value = "";
                }
            }
        }

        const slDisplay = document.getElementById('total-sl');
        slDisplay.innerText = grandTotalSL;
        slDisplay.className = (grandTotalSL > 23) ? 'over-limit' : '';
        document.getElementById('total-pts').innerText = grandTotalPts;
    }

    function inc(id) {
        const el = document.getElementById(id);
        el.value = (parseInt(el.value) || 0) + 1;
        save(); calculate();
    }

    function save() {
        document.querySelectorAll('.store').forEach(el => localStorage.setItem(el.id, el.value));
    }

    function load() {
        document.querySelectorAll('.store').forEach(el => {
            const v = localStorage.getItem(el.id);
            if(v !== null) el.value = v;
        });
        calculate();
    }

    function resetAll() {
        if(confirm("Wipe all matches and start new team night?")) {
            localStorage.clear();
            location.reload();
        }
    }

    document.addEventListener('input', () => { calculate(); save(); });
    window.onload = load;
</script>
</body>
</html>
