<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MVP TV - Pro Scorekeeper 2026</title>
    <style>
        :root { --slate: #0f172a; --surface: #1e293b; --felt: #10b981; --gold: #f59e0b; --danger: #ef4444; --text: #f8fafc; --border: #334155; }
        * { box-sizing: border-box; touch-action: manipulation; -webkit-user-select: none; }
        body { font-family: 'Inter', system-ui, sans-serif; background-color: var(--slate); margin: 0; padding: 12px; color: var(--text); line-height: 1.5; }
        .app-container { background: var(--surface); border: 1px solid var(--border); border-radius: 20px; padding: 20px; max-width: 500px; margin: auto; min-height: 85vh; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .match-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; padding-bottom: 12px; border-bottom: 1px solid var(--border); }
        .match-badge { background: var(--slate); padding: 6px 14px; border-radius: 20px; font-size: 0.75rem; color: var(--gold); border: 1px solid var(--gold); font-weight: 800; }
        .lag-badge { background: var(--gold); color: var(--slate); padding: 6px 14px; border-radius: 12px; font-size: 0.7rem; font-weight: 900; cursor: pointer; }
        .player-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .player-card { background: var(--slate); border: 1px solid var(--border); padding: 12px; border-radius: 16px; position: relative; }
        .score-bubble { position: absolute; top: -10px; right: -10px; background: var(--felt); color: white; width: 34px; height: 34px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 900; border: 2px solid var(--slate); box-shadow: 0 4px 10px rgba(0,0,0,0.4); }
        .player-input { width: 100%; background: transparent; border: none; color: white; font-weight: 700; border-bottom: 1px solid var(--border); margin-bottom: 8px; outline: none; padding: 6px 0; font-size: 1rem; }
        .sl-select { width: 100%; background: var(--surface); color: white; border: 1px solid var(--border); border-radius: 8px; padding: 8px; font-weight: bold; }
        .scoring-arena { display: grid; grid-template-columns: 1fr auto 1fr; gap: 15px; align-items: center; margin-bottom: 20px; }
        .btn-pro { background: var(--slate); border: 1px solid var(--border); color: white; border-radius: 50%; width: 60px; height: 60px; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 0.8rem; transition: transform 0.1s; }
        .btn-pro.win { background: var(--felt); width: 80px; height: 80px; font-weight: 900; font-size: 1.1rem; border: none; }
        .btn-inning { width: 68px; height: 68px; border-radius: 15px; border: 3px solid var(--gold); background: var(--slate); color: var(--gold); font-size: 1.8rem; font-weight: 900; cursor: pointer; }
        .btn-pro:active, .btn-inning:active { transform: scale(0.9); }
        .session-overview { margin-top: 24px; background: var(--slate); border-radius: 16px; padding: 15px; border: 1px solid var(--border); }
        .table-row { display: grid; grid-template-columns: 0.8fr 2.5fr 1fr 1fr; gap: 8px; font-size: 0.9rem; border-bottom: 1px solid var(--surface); padding: 10px 0; align-items: center; }
        .modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); backdrop-filter: blur(8px); justify-content: center; align-items: center; }
        .modal-box { background: var(--surface); padding: 25px; border-radius: 25px; width: 90%; max-width: 380px; text-align: center; border: 1px solid var(--border); box-shadow: 0 20px 50px rgba(0,0,0,0.6); }
        .win-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin: 15px 0; }
        .btn-win-opt { background: var(--slate); color: white; padding: 14px; border: 1px solid var(--border); border-radius: 12px; font-weight: 700; cursor: pointer; }
        .btn-action { width: 100%; padding: 14px; border-radius: 12px; border: none; font-weight: 700; cursor: pointer; margin-top: 10px; font-size: 0.95rem; }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="match-header">
            <div class="match-badge">MATCH <span id="match-num">1</span> OF 5</div>
            <div id="lag-display" class="lag-badge" onclick="toggleLag()">LAG: HOME</div>
            <div class="match-badge" id="race-display">RACE 0 - 0</div>
        </div>
        <div class="player-grid">
            <div class="player-card">
                <div class="score-bubble" id="h-games">0</div>
                <input type="text" id="h-name" class="player-input" value="Player A">
                <select id="h-sl" class="sl-select" onchange="updateRace()">
                    <option value="2">SL2</option><option value="3">SL3</option><option value="4" selected>SL4</option><option value="5">SL5</option><option value="6">SL6</option><option value="7">SL7</option>
                </select>
            </div>
            <div class="player-card">
                <div class="score-bubble" id="a-games">0</div>
                <input type="text" id="a-name" class="player-input" value="Player B">
                <select id="a-sl" class="sl-select" onchange="updateRace()">
                    <option value="2">SL2</option><option value="3">SL3</option><option value="4" selected>SL4</option><option value="5">SL5</option><option value="6">SL6</option><option value="7">SL7</option>
                </select>
            </div>
        </div>
        <div class="scoring-arena">
            <div style="display:flex; flex-direction:column; gap:12px; align-items:center;">
                <button class="btn-pro" id="btn-hDef">Def <span id="hDef-val">0</span></button>
                <button class="btn-pro" id="btn-hTO">T.O. <span id="hTO-val">0</span></button>
                <button class="btn-pro win" onclick="openWin('h')">RACK</button>
            </div>
            <button class="btn-inning" id="innings-btn"><span id="innings-val">0</span></button>
            <div style="display:flex; flex-direction:column; gap:12px; align-items:center;">
                <button class="btn-pro" id="btn-aDef">Def <span id="aDef-val">0</span></button>
                <button class="btn-pro" id="btn-aTO">T.O. <span id="aTO-val">2</span></button>
                <button class="btn-pro win" onclick="openWin('a')">RACK</button>
            </div>
        </div>
        <div class="session-overview">
            <div id="results-list"></div>
        </div>
        <button class="btn-action" onclick="exportSession()" style="background:var(--felt); color:var(--slate);">EXPORT SESSION</button>
        <button class="btn-action" onclick="clearSession()" style="background:var(--danger); color:white;">RESET ALL DATA</button>
    </div>

    <!-- Modals -->
    <div id="winModal" class="modal">
        <div class="modal-box">
            <h3>Game Outcome</h3>
            <div class="win-grid">
                <button class="btn-win-opt" onclick="confirmRack('Normal')">Normal</button>
                <button class="btn-win-opt" onclick="confirmRack('8BB')">8BB</button>
                <button class="btn-win-opt" onclick="confirmRack('B&R')">B&R</button>
                <button class="btn-win-opt" onclick="confirmRack('S8')">S8</button>
            </div>
        </div>
    </div>

    <script>
        let currentMatch = { h: 0, a: 0, hDef: 0, aDef: 0, hTO: 2, aTO: 2, innings: 0 };
        let session = JSON.parse(localStorage.getItem('poolSession')) || [];
        let activePlayer = null;

        // Official 8-Ball Race Matrix
        const raceTable = {
            2: { 2: "2/2", 3: "2/3", 4: "2/4", 5: "2/5", 6: "2/6", 7: "2/7" },
            3: { 2: "3/2", 3: "2/2", 4: "2/3", 5: "2/4", 6: "2/5", 7: "2/6" },
            4: { 2: "4/2", 3: "3/2", 4: "3/3", 5: "3/4", 6: "3/5", 7: "3/6" },
            5: { 2: "5/2", 3: "4/2", 4: "4/3", 5: "4/4", 6: "4/5", 7: "4/6" },
            6: { 2: "6/2", 3: "5/2", 4: "5/3", 5: "5/4", 6: "5/5", 7: "4/6" },
            7: { 2: "7/2", 3: "6/2", 4: "6/3", 5: "6/4", 6: "6/4", 7: "5/5" }
        };

        function updateRace() {
            const hSL = document.getElementById('h-sl').value;
            const aSL = document.getElementById('a-sl').value;
            document.getElementById('race-display').innerText = `RACE ${raceTable[hSL][aSL]}`;
        }

        function toggleLag() {
            const lag = document.getElementById('lag-display');
            lag.innerText = lag.innerText === "LAG: HOME" ? "LAG: AWAY" : "LAG: HOME";
        }

        // Increment logic
        document.getElementById('innings-btn').onclick = () => {
            currentMatch.innings++;
            document.getElementById('innings-val').innerText = currentMatch.innings;
        };

        document.getElementById('btn-hDef').onclick = () => {
            currentMatch.hDef++;
            document.getElementById('hDef-val').innerText = currentMatch.hDef;
        };

        document.getElementById('btn-aDef').onclick = () => {
            currentMatch.aDef++;
            document.getElementById('aDef-val').innerText = currentMatch.aDef;
        };

        function openWin(player) {
            activePlayer = player;
            document.getElementById('winModal').style.display = 'flex';
        }

        function confirmRack(type) {
            if (activePlayer === 'h') currentMatch.h++;
            else currentMatch.a++;
            
            document.getElementById('h-games').innerText = currentMatch.h;
            document.getElementById('a-games').innerText = currentMatch.a;
            document.getElementById('winModal').style.display = 'none';
            checkMatchOver();
        }

        function checkMatchOver() {
            const raceStr = document.getElementById('race-display').innerText.replace('RACE ', '');
            const parts = raceStr.split('/');
            const hTarget = parseInt(parts[0]);
            const aTarget = parseInt(parts[1]);

            if (currentMatch.h >= hTarget || currentMatch.a >= aTarget) {
                if (confirm("Match Over. Save results?")) saveMatch();
            }
        }

        function saveMatch() {
            const matchData = {
                hName: document.getElementById('h-name').value,
                aName: document.getElementById('a-name').value,
                score: `${currentMatch.h}-${currentMatch.a}`,
                innings: currentMatch.innings,
                def: `${currentMatch.hDef}/${currentMatch.aDef}`
            };
            session.push(matchData);
            localStorage.setItem('poolSession', JSON.stringify(session));
            renderSession();
            resetMatch();
        }

        function renderSession() {
            const list = document.getElementById('results-list');
            list.innerHTML = session.map((m, i) => `
                <div class="table-row">
                    <span>#${i+1}</span>
                    <span>${m.hName} vs ${m.aName}</span>
                    <span>${m.score}</span>
                    <span>${m.innings}i / ${m.def}D</span>
                </div>
            `).join('');
            document.getElementById('match-num').innerText = session.length + 1;
        }

        function resetMatch() {
            currentMatch = { h: 0, a: 0, hDef: 0, aDef: 0, hTO: 2, aTO: 2, innings: 0 };
            ['h-games', 'a-games', 'innings-val', 'hDef-val', 'aDef-val'].forEach(id => {
                document.getElementById(id).innerText = '0';
            });
        }

        function clearSession() {
            if(confirm("Erase all match data?")) {
                localStorage.removeItem('poolSession');
                location.reload();
            }
        }

        function exportSession() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(session));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "pool_session_2026.json");
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
        }

        updateRace();
        renderSession();
    </script>
</body>
</html>
