<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MVP TV APA 8-Ball Pro</title>
    <script src="https://cdnjs.cloudflare.com"></script>
    <style>
        :root { 
            --felt: #2d5a27; --slate: #1a1a1a; --gold: #f1c40f; 
            --chalk: #3498db; --ball-8: #2c3e50; --danger: #e74c3c;
            --app-bg: #ffebee;
        }
        * { box-sizing: border-box; touch-action: manipulation; -webkit-user-select: none; }
        body { font-family: 'Inter', sans-serif; background-color: var(--slate); margin: 0; padding: 10px; color: #333; }
        
        .branding { text-align: center; margin-bottom: 5px; }
        .logo-box { background: white; padding: 5px 15px; display: inline-block; border-radius: 12px; }
        .logo-mvp { color:#00FF00; font-size: 24px; font-weight: 900; }
        .logo-tv { color:#FF0000; font-size: 32px; font-style: italic; font-weight: 900; font-family: 'Brush Script MT', cursive; margin-left: -5px; }
        .app-subtitle { display: block; color: #fff; font-weight: 700; font-size: 0.8rem; margin-top: 5px; text-transform: uppercase; }

        .app-container { background: var(--app-bg); border-radius: 15px; padding: 15px; max-width: 600px; margin: auto; width: 100%; min-height: 85vh; }
        
        .match-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .team-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        .team-box { background: rgba(0,0,0,0.05); padding: 8px; border-radius: 8px; }
        
        .race-banner { background: var(--ball-8); color: white; padding: 6px; border-radius: 8px; text-align: center; font-weight: bold; margin-bottom: 10px; font-size: 0.8rem; }

        .controls-grid { display: grid; grid-template-columns: 1fr auto 1fr; gap: 15px; margin: 10px 0; align-items: center; }
        .btn-8ball { 
            background: var(--ball-8); color: white; border: none; border-radius: 50%; 
            width: 55px; height: 55px; font-weight: 900; box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            display: flex; flex-direction: column; justify-content: center; align-items: center; cursor: pointer;
        }
        .btn-8ball.win { background: var(--felt); width: 70px; height: 70px; border: 3px solid #fff; }
        .label { font-size: 0.5rem; text-transform: uppercase; pointer-events: none; }

        #win-modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); justify-content: center; align-items: center; }
        .modal-content { background: var(--app-bg); padding: 20px; border-radius: 15px; width: 90%; max-width: 320px; text-align: center; }
        .win-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .win-opt { background: var(--ball-8); color: white; padding: 12px; border: none; border-radius: 8px; font-weight: bold; }

        .match-log { background: white; padding: 10px; border-radius: 8px; font-family: monospace; font-size: 0.75rem; margin-top: 10px; border: 1px solid #ddd; }
        .edit-btn { display: none; background: #555; color: white; padding: 5px 12px; border-radius: 5px; border: none; font-size: 0.7rem; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div class="branding">
    <div class="logo-box"><span class="logo-mvp">MVP</span><span class="logo-tv">TV</span></div>
    <span class="app-subtitle">8 Ball 3 Pt. Offline Scorekeeper</span>
</div>

<div class="app-container" id="capture-area">
    <div class="match-header">
        <span style="font-weight: 900; font-size: 1rem;">MATCH <span id="match-num">1</span>/5</span>
        <button id="edit-btn-top" class="edit-btn" onclick="toggleEdit()">EDIT</button>
        <button onclick="resetMatch()" style="background:var(--danger); color:white; border:none; padding:5px 10px; border-radius:5px; font-weight:bold; font-size:0.7rem;">RESET</button>
    </div>

    <div class="team-grid">
        <div class="team-box"><input type="text" id="h-player" placeholder="Home Player" style="width:100%; border:none; border-bottom:1px solid #ccc; background:transparent; font-weight:bold;">
            <select id="h-sl" onchange="updateRace()" style="width:100%; margin-top:4px;"><option value="2">SL2</option><option value="3">SL3</option><option value="4" selected>SL4</option><option value="5">SL5</option><option value="6">SL6</option><option value="7">SL7</option></select>
        </div>
        <div class="team-box"><input type="text" id="a-player" placeholder="Away Player" style="width:100%; border:none; border-bottom:1px solid #ccc; background:transparent; font-weight:bold;">
            <select id="a-sl" onchange="updateRace()" style="width:100%; margin-top:4px;"><option value="2">SL2</option><option value="3">SL3</option><option value="4" selected>SL4</option><option value="5">SL5</option><option value="6">SL6</option><option value="7">SL7</option></select>
        </div>
    </div>

    <div class="race-banner" id="race-display">RACE: 3 TO 3</div>

    <div class="controls-grid" id="main-controls">
        <div style="display:flex; flex-direction:column; gap:12px; align-items:center;">
            <button class="btn-8ball touch-btn" data-side="h" data-type="def"><span class="label">Def</span><span id="h-def-cur">0</span></button>
            <button class="btn-8ball touch-btn" data-side="h" data-type="to"><span class="label">T.O.</span><span id="h-to-cur">0</span></button>
            <button class="btn-8ball win" onclick="openWin('h')"><span class="label">WIN</span></button>
        </div>
        <div style="text-align:center;">
            <div style="font-size:0.6rem; font-weight:bold;">INNING</div>
            <button class="touch-btn" data-side="both" data-type="inn" id="inn-cur" style="width:60px; height:60px; border-radius:12px; border:3px solid var(--ball-8); background:white; font-weight:900; font-size:1.5rem;">0</button>
        </div>
        <div style="display:flex; flex-direction:column; gap:12px; align-items:center;">
            <button class="btn-8ball touch-btn" data-side="a" data-type="def"><span class="label">Def</span><span id="a-def-cur">0</span></button>
            <button class="btn-8ball touch-btn" data-side="a" data-type="to"><span class="label">T.O.</span><span id="a-to-cur">0</span></button>
            <button class="btn-8ball win" onclick="openWin('a')"><span class="label">WIN</span></button>
        </div>
    </div>

    <div class="match-log" id="log">Logs will appear here...</div>
    
    <button id="next-match-btn" onclick="nextMatch()" style="display:none; width:100%; padding:12px; background:var(--felt); color:white; border:none; border-radius:8px; font-weight:bold; margin-top:10px;">FINISH MATCH & START NEXT</button>
</div>

<div id="win-modal"><div class="modal-content"><h3>Win Category</h3><div class="win-grid">
    <button class="win-opt" onclick="confirmWin('Normal')">Normal</button><button class="win-opt" onclick="confirmWin('B&R')">B&R</button><button class="win-opt" onclick="confirmWin('8BB')">8BB</button><button class="win-opt" onclick="confirmWin('E8')">E8</button><button class="win-opt" onclick="confirmWin('S8')">S8</button><button class="win-opt" onclick="confirmWin('WP')">WP</button>
</div><button onclick="document.getElementById('win-modal').style.display='none'" style="margin-top:15px; color:var(--danger); border:none; background:none; font-weight:bold;">CANCEL</button></div></div>

<script>
    // APA Race Chart [SL Home][SL Away] = Games
    const raceChart = { 2:{2:2,3:2,4:2,5:2,6:2,7:2}, 3:{2:3,3:3,4:3,5:3,6:3,7:3}, 4:{2:4,3:4,4:4,5:4,6:4,7:4}, 5:{2:5,3:5,4:5,5:5,6:5,7:5}, 6:{2:6,3:6,4:6,5:6,6:6,7:6}, 7:{2:7,3:7,4:7,5:7,6:7,7:7} };
    let matchIndex = 1;
    let match = { h: { wins: 0, hist: [], def: 0, to: 0, sl: 4 }, a: { wins: 0, hist: [], def: 0, to: 0, sl: 4 }, inn: 0, status: 'active', activeSide: null };

    function updateRace() {
        match.h.sl = parseInt(document.getElementById('h-sl').value);
        match.a.sl = parseInt(document.getElementById('a-sl').value);
        const r = raceChart[match.h.sl][match.a.sl];
        match.h.goal = r; match.a.goal = r;
        document.getElementById('race-display').innerText = `RACE: ${r} TO ${r}`;
    }

    // Touch Handling for Double Tap and Hold
    document.querySelectorAll('.touch-btn').forEach(btn => {
        let lastTap = 0, timer;
        const side = btn.dataset.side, type = btn.dataset.type;

        btn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            const now = Date.now();
            if (now - lastTap < 300) { // Double Tap
                clearTimeout(timer);
                modifyStat(side, type, -1);
            } else { // Potential Hold or Single Tap
                timer = setTimeout(() => modifyStat(side, type, 'reset'), 600);
            }
            lastTap = now;
        });

        btn.addEventListener('touchend', () => {
            clearTimeout(timer);
            if (Date.now() - lastTap >= 300) modifyStat(side, type, 1);
        });
    });

    function modifyStat(side, type, val) {
        if (match.status !== 'active') return;
        const target = side === 'both' ? match : match[side];
        if (val === 'reset') target[type] = 0;
        else target[type] = Math.max(0, target[type] + val);
        render();
    }

    function openWin(side) { match.activeSide = side; document.getElementById('win-modal').style.display = 'flex'; }

    function confirmWin(type) {
        const side = match.activeSide;
        match[side].hist.push(`g${match.h.wins+match.a.wins+1}${type==='Normal'?'':'('+type+')'} ${match.inn}in ${match[side].def}def ${match[side].to}to`);
        match[side].wins++;
        match.inn = 0; match.h.def = 0; match.h.to = 0; match.a.def = 0; match.a.to = 0;
        document.getElementById('win-modal').style.display = 'none';
        if (match[side].wins >= match[side].goal) finishMatch();
        render();
    }

    function finishMatch() {
        match.status = 'done';
        document.getElementById('main-controls').style.display = 'none';
        document.getElementById('next-match-btn').style.display = 'block';
        document.getElementById('edit-btn-top').style.display = 'block';
        
        let hPts = 0, aPts = 0; // APA 3-Point System
        if(match.h.wins > match.a.wins) {
            if(match.a.wins === 0) { hPts = 3; aPts = 0; }
            else if(match.a.wins === match.a.goal - 1) { hPts = 2; aPts = 1; }
            else { hPts = 2; aPts = 0; }
        } else {
            if(match.h.wins === 0) { aPts = 3; hPts = 0; }
            else if(match.h.wins === match.h.goal - 1) { aPts = 2; hPts = 1; }
            else { aPts = 2; hPts = 0; }
        }
        match.h.finalPts = hPts; match.a.finalPts = aPts;
    }

    function nextMatch() {
        if (matchIndex >= 5) return alert("Session Over: 5 Matches Complete");
        matchIndex++;
        document.getElementById('match-num').innerText = matchIndex;
        resetMatch();
    }

    function resetMatch() {
        match = { h: { wins: 0, hist: [], def: 0, to: 0, sl: match.h.sl }, a: { wins: 0, hist: [], def: 0, to: 0, sl: match.a.sl }, inn: 0, status: 'active' };
        document.getElementById('main-controls').style.display = 'grid';
        document.getElementById('next-match-btn').style.display = 'none';
        document.getElementById('edit-btn-top').style.display = 'none';
        render();
    }

    function toggleEdit() {
        document.getElementById('main-controls').style.display = 'grid';
        match.status = 'active';
    }

    function render() {
        document.getElementById('inn-cur').innerText = match.inn;
        document.getElementById('h-def-cur').innerText = match.h.def;
        document.getElementById('h-to-cur').innerText = match.h.to;
        document.getElementById('a-def-cur').innerText = match.a.def;
        document.getElementById('a-to-cur').innerText = match.a.to;
        
        if(match.status === 'done') {
            const hName = document.getElementById('h-player').value || "Home";
            const aName = document.getElementById('a-player').value || "Away";
            document.getElementById('log').innerHTML = `<strong>${hName} (${match.h.finalPts}pts)</strong> vs <strong>${aName} (${match.a.finalPts}pts)</strong><br>${match.h.hist.join(', ')}<br>${match.a.hist.join(', ')}`;
        }
    }
    updateRace();
</script>
</body>
</html>
