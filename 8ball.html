<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MVP TV APA 8-Ball Pro</title>
    <script src="https://cdnjs.cloudflare.com"></script>
    <style>
        :root { 
            --felt: #2d5a27; --slate: #1a1a1a; --gold: #f1c40f; 
            --chalk: #3498db; --ball-8: #2c3e50; --danger: #e74c3c;
            --app-bg: #ffebee;
        }
        * { box-sizing: border-box; touch-action: manipulation; }
        body { 
            font-family: 'Inter', sans-serif; background-color: var(--slate); 
            margin: 0; padding: 10px; color: #333;
        }
        .branding { text-align: center; margin-bottom: 10px; position: relative; }
        .logo-box { background: white; padding: 5px 15px; display: inline-block; border-radius: 12px; }
        .logo-mvp { color:#00FF00; font-size: 24px; font-weight: 900; }
        .logo-tv { color:#FF0000; font-size: 32px; font-style: italic; font-weight: 900; font-family: 'Brush Script MT', cursive; margin-left: -5px; }
        
        .app-container { 
            background: var(--app-bg); border-radius: 15px; padding: 15px; 
            max-width: 600px; margin: auto; width: 100%; min-height: 90vh;
        }

        .header-actions { position: absolute; top: 0; right: 0; display: flex; gap: 5px; }
        .team-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        .team-box { background: rgba(0,0,0,0.05); padding: 10px; border-radius: 8px; }
        .player-row { margin-top: 5px; display: flex; align-items: center; gap: 4px; }
        
        .race-banner { 
            background: var(--ball-8); color: white; padding: 8px; 
            border-radius: 8px; text-align: center; font-weight: bold; margin-bottom: 10px; 
        }

        .controls-grid { display: grid; grid-template-columns: 1fr auto 1fr; gap: 15px; margin: 15px 0; align-items: center; }
        .btn-8ball { 
            background: var(--ball-8); color: white; border: none; border-radius: 50%; 
            width: 50px; height: 50px; font-weight: 900; box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .btn-8ball.win { background: var(--felt); width: 65px; height: 65px; border: 3px solid #fff; }
        .label { font-size: 0.5rem; text-transform: uppercase; margin-bottom: -2px; }

        #win-modal {
            display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); justify-content: center; align-items: center;
        }
        .modal-content { background: var(--app-bg); padding: 20px; border-radius: 15px; width: 85%; max-width: 320px; text-align: center; }
        .win-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .win-opt { background: var(--ball-8); color: white; padding: 12px; border: none; border-radius: 8px; font-weight: bold; }

        .history-log { background: white; padding: 10px; border-radius: 8px; font-family: monospace; font-size: 0.8rem; margin-top: 10px; }
        .winner-tag { color: var(--felt); font-weight: bold; text-decoration: underline; }
    </style>
</head>
<body>

<div class="branding">
    <div class="logo-box"><span class="logo-mvp">MVP</span><span class="logo-tv">TV</span></div>
    <div class="header-actions">
        <button onclick="toggleEdit()" id="edit-btn" style="padding:5px 10px; border-radius:5px; border:none; background:#555; color:white;">EDIT</button>
    </div>
</div>

<div class="app-container" id="capture-area">
    <div class="team-grid">
        <div class="team-box">
            <input type="text" id="h-team" placeholder="HOME TEAM" style="width:100%; font-weight:bold; border:none; background:transparent;">
            <div class="player-row">
                <input type="text" id="h-player" placeholder="Player" style="width:70%; border:none; border-bottom:1px solid #ccc; background:transparent;">
                <select id="h-sl" onchange="updateRace()" style="width:30%;">
                    <option value="2">2</option><option value="3">3</option><option value="4" selected>4</option>
                    <option value="5">5</option><option value="6">6</option><option value="7">7</option>
                </select>
            </div>
        </div>
        <div class="team-box">
            <input type="text" id="a-team" placeholder="AWAY TEAM" style="width:100%; font-weight:bold; border:none; background:transparent;">
            <div class="player-row">
                <input type="text" id="a-player" placeholder="Player" style="width:70%; border:none; border-bottom:1px solid #ccc; background:transparent;">
                <select id="a-sl" onchange="updateRace()" style="width:30%;">
                    <option value="2">2</option><option value="3">3</option><option value="4" selected>4</option>
                    <option value="5">5</option><option value="6">6</option><option value="7">7</option>
                </select>
            </div>
        </div>
    </div>

    <div class="race-banner" id="race-display">RACE: 3 TO 3</div>

    <div class="controls-grid" id="main-controls">
        <div style="display:flex; flex-direction:column; gap:15px; align-items:center;">
            <button class="btn-8ball" onclick="stat('h','def',1)"><span class="label">Def</span><span id="h-def-cur">0</span></button>
            <button class="btn-8ball" onclick="stat('h','to',1)"><span class="label">T.O.</span><span id="h-to-cur">0</span></button>
            <button class="btn-8ball win" onclick="openWin('h')"><span class="label">WIN</span></button>
        </div>
        
        <div style="text-align:center;">
            <div style="font-size:0.7rem; font-weight:bold;">INNING</div>
            <button onclick="stat('both','inn',1)" style="width:50px; height:50px; border-radius:8px; border:2px solid var(--ball-8); background:white; font-weight:bold; font-size:1.2rem;" id="inn-cur">0</button>
        </div>

        <div style="display:flex; flex-direction:column; gap:15px; align-items:center;">
            <button class="btn-8ball" onclick="stat('a','def',1)"><span class="label">Def</span><span id="a-def-cur">0</span></button>
            <button class="btn-8ball" onclick="stat('a','to',1)"><span class="label">T.O.</span><span id="a-to-cur">0</span></button>
            <button class="btn-8ball win" onclick="openWin('a')"><span class="label">WIN</span></button>
        </div>
    </div>

    <div class="history-log" id="log">Logs will appear here...</div>
</div>

<div id="win-modal">
    <div class="modal-content">
        <h3>Win Category</h3>
        <div class="win-grid">
            <button class="win-opt" onclick="confirmWin('Normal')">Normal</button>
            <button class="win-opt" onclick="confirmWin('B&R')">B&R</button>
            <button class="win-opt" onclick="confirmWin('8BB')">8BB</button>
            <button class="win-opt" onclick="confirmWin('E8')">E8</button>
            <button class="win-opt" onclick="confirmWin('S8')">S8</button>
            <button class="win-opt" onclick="confirmWin('WP')">WP</button>
        </div>
        <button onclick="document.getElementById('win-modal').style.display='none'" style="margin-top:15px; border:none; background:none; color:var(--danger); font-weight:bold;">CANCEL</button>
    </div>
</div>

<script>
    // APA Race Chart [SL Home][SL Away] = [Home Race, Away Race]
    const raceChart = {
        2: { 2:[2,2], 3:[2,3], 4:[2,4], 5:[2,5], 6:[2,6], 7:[2,7] },
        3: { 2:[3,2], 3:[2,2], 4:[2,3], 5:[2,4], 6:[2,5], 7:[2,6] },
        4: { 2:[4,2], 3:[3,2], 4:[3,3], 5:[3,4], 6:[3,5], 7:[2,5] },
        5: { 2:[5,2], 3:[4,2], 4:[4,3], 5:[4,4], 6:[4,5], 7:[3,5] },
        6: { 2:[6,2], 3:[5,2], 4:[5,3], 5:[5,4], 6:[5,5], 7:[4,5] },
        7: { 2:[7,2], 3:[6,2], 4:[5,2], 5:[5,3], 6:[5,4], 7:[5,5] }
    };

    let match = {
        h: { wins: 0, hist: [], def: 0, to: 0, sl: 4 },
        a: { wins: 0, hist: [], def: 0, to: 0, sl: 4 },
        inn: 0, status: 'active', activeSide: null
    };

    function updateRace() {
        match.h.sl = parseInt(document.getElementById('h-sl').value);
        match.a.sl = parseInt(document.getElementById('a-sl').value);
        const r = raceChart[match.h.sl][match.a.sl];
        match.h.goal = r[0]; match.a.goal = r[1];
        document.getElementById('race-display').innerText = `RACE: ${r[0]} TO ${r[1]}`;
    }

    function stat(side, field, val) {
        if(side === 'both') match.inn += val;
        else {
            const limit = match[side].sl >= 4 ? 1 : 2;
            if(field === 'to' && match[side].to >= limit) return alert("Timeout limit reached!");
            match[side][field] += val;
        }
        render();
    }

    function openWin(side) {
        match.activeSide = side;
        document.getElementById('win-modal').style.display = 'flex';
    }

    function confirmWin(type) {
        const side = match.activeSide;
        const entry = `g${match.h.wins+match.a.wins+1}${type === 'Normal' ? '' : '('+type+')'} ${match.inn}in ${match[side].def}def ${match[side].to}to`;
        match[side].hist.push(entry);
        match[side].wins++;
        
        // Reset for next rack
        match.inn = 0; match.h.def = 0; match.h.to = 0; match.a.def = 0; match.a.to = 0;
        document.getElementById('win-modal').style.display = 'none';

        if(match[side].wins >= match[side].goal) finishMatch();
        render();
    }

    function finishMatch() {
        match.status = 'done';
        document.getElementById('main-controls').style.display = 'none';
        
        // 3-Point System Calculation
        let hPts = 0, aPts = 0;
        if(match.h.wins > match.a.wins) {
            if(match.a.wins === 0) { hPts = 3; aPts = 0; }
            else if(match.a.wins === match.a.goal - 1) { hPts = 2; aPts = 1; }
            else { hPts = 2; aPts = 0; }
        } else {
            if(match.h.wins === 0) { aPts = 3; hPts = 0; }
            else if(match.h.wins === match.h.goal - 1) { aPts = 2; hPts = 1; }
            else { aPts = 2; hPts = 0; }
        }
        match.h.finalPts = hPts; match.a.finalPts = aPts;
    }

    function render() {
        document.getElementById('inn-cur').innerText = match.inn;
        document.getElementById('h-def-cur').innerText = match.h.def;
        document.getElementById('h-to-cur').innerText = match.h.to;
        document.getElementById('a-def-cur').innerText = match.a.def;
        document.getElementById('a-to-cur').innerText = match.a.to;

        const hName = document.getElementById('h-player').value || "Home";
        const aName = document.getElementById('a-player').value || "Away";

        if(match.status === 'done') {
            const hWin = match.h.wins > match.a.wins;
            let html = `<div style="text-align:center; font-size:1rem; margin-bottom:10px;">`;
            html += `<span class="${hWin?'winner-tag':''}">${hName} (${match.h.finalPts}pts)</span> vs `;
            html += `<span class="${!hWin?'winner-tag':''}">${aName} (${match.a.finalPts}pts)</span></div>`;
            html += `<div>${hName}: ${match.h.hist.join(', ')}</div>`;
            html += `<div style="margin-top:5px;">${aName}: ${match.a.hist.join(', ')}</div>`;
            document.getElementById('log').innerHTML = html;
        }
    }

    updateRace();
</script>
</body>
</html>
